<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>KMS服务器搭建激活win10/office</title>
    <link href="/2021/04/17/Linux/install_kms/"/>
    <url>/2021/04/17/Linux/install_kms/</url>
    
    <content type="html"><![CDATA[<p>KMS全称Key Management Service，即通过系统管理员（System Administrator）使用一个批量激活密钥（也就是大家经常看到的Volume Key）Vol密钥，设置一个激活服务器（Activation Server），并在每一个客户机上安装KMS的客户端，就可以进行批量激活和管理，极大的减少了工作量。</p><p>其实KMS服务器很早之前我就已经搭建过了，但是现在自己家的电脑和office都会提示过期，刚好自己也买了个阿里云的服务器，干脆就自建KMS服务器，虽然网上也有，但是怕有木马病毒，于是我开始了…其实搭建kms真的很简单，已经有大神写好的了，我的服务器是centos7</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">项目地址:https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/Wind4/</span>vlmcsd<br></code></pre></td></tr></table></figure><h2 id="一、部署KMS"><a href="#一、部署KMS" class="headerlink" title="一、部署KMS"></a>一、部署KMS</h2><ul><li><p><strong>下载安装包</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@aliyun</span>-server <span class="hljs-keyword">local</span>]<span class="hljs-meta"># wget https://github.com/Wind4/vlmcsd/releases/download/svn1113/binaries.tar.gz</span><br></code></pre></td></tr></table></figure></li><li><p><strong>解压</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@aliyun</span>-server <span class="hljs-keyword">local</span>]<span class="hljs-meta"># tar -zxvf binaries.tar.gz</span><br></code></pre></td></tr></table></figure></li><li><p><strong>进入该目录，下面是我存放的路径</strong></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@aliyun-server <span class="hljs-keyword">static</span>]# pwd<br><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/binaries/</span>Linux<span class="hljs-regexp">/intel/</span><span class="hljs-keyword">static</span><br></code></pre></td></tr></table></figure></li><li><p> <strong>运行</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@aliyun</span>-server <span class="hljs-keyword">static</span>]<span class="hljs-meta"># ./vlmcsd-x64-musl-static</span><br></code></pre></td></tr></table></figure></li><li><p><strong>查看是否运行成功</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">[root<span class="hljs-variable">@aliyun</span>-server static]<span class="hljs-comment"># netstat -antp | grep vlmcsd</span><br>tcp        0      0 0.0.0.0<span class="hljs-symbol">:</span><span class="hljs-number">1688</span>            0.0.0.0<span class="hljs-symbol">:*</span>               LISTEN      <span class="hljs-number">2662</span>/./vlmcsd-x64-m <br>tcp6       0      0 ::<span class="hljs-symbol">:</span><span class="hljs-number">1688</span>                 ::<span class="hljs-symbol">:*</span>                    LISTEN      <span class="hljs-number">2662</span>/./vlmcsd-x64-m <br></code></pre></td></tr></table></figure></li></ul><p><strong>ps: 如果你安装了iptables，需要用一下命令开启1688端口, 然后我这个因为是阿里云服务器的嘛，所以还需要在控制在放开1688端口</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pf">iptables -I INPUT <span class="hljs-number">5</span> -p tcp -m <span class="hljs-keyword">state</span> -–<span class="hljs-keyword">state</span> NEW -m tcp -–dport <span class="hljs-number">1688</span> -j ACCEPT<br><br></code></pre></td></tr></table></figure><p><img src="/img/Linux/kms_01.png"></p><h2 id="二、KMS激活系统"><a href="#二、KMS激活系统" class="headerlink" title="二、KMS激活系统"></a>二、KMS激活系统</h2><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta">#KMS服务激活适用对象: VOL版本的Windows和Office</span><br></code></pre></td></tr></table></figure><ul><li><strong>确认系统是否VOL版本,如果不知道自己是什么版本,可以用以下命令查看。</strong></li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#用cmd以管理员生打开运行</span><br><span class="hljs-attribute">C</span>:\Windows\system<span class="hljs-number">32</span>&gt;slmgr /dlv<br></code></pre></td></tr></table></figure><p>在描述这行可以看到VOLUME则就是VOL版本的，如果有RETAIL则就是零售版本的。<br><img src="/img/Linux/kms_02.png"></p><ul><li><strong>零售版本如何转换为VOL版本呢，可以按照<a href="https://docs.microsoft.com/zh-cn/windows-server/get-started/kmsclientkeys">KMS客户端安装密钥</a>，用以下命令，然后找对应的操作版本和密钥安装转换即可，如果系统是VOL版本的就不用了做此步骤。</strong></li></ul><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">slmgr <span class="hljs-string">/ipk</span> VOL-key<br>例如<span class="hljs-function">:C</span>:\Windows\system32&gt;slmgr <span class="hljs-string">/ipk</span> W269N-WFGWX-YVC9B-4J6C9-T83GX<br></code></pre></td></tr></table></figure><p><img src="/img/Linux/kms_03.png"></p><ul><li><strong>现在我们来尝试激活系统，这里我的系统是windows10 专业版本</strong><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment">#查看版本</span><br>slmgr <span class="hljs-string">/dlv</span><br><span class="hljs-comment">#指定kms服务器，大家可以用我的服务器来激活，不要攻击我哈</span><br>slmgr <span class="hljs-string">/skms</span> 121.40.193.242<br><span class="hljs-comment">#激活</span><br>slmgr <span class="hljs-string">/ato</span><br></code></pre></td></tr></table></figure></li></ul><p><img src="/img/Linux/kms_04.png"><br><img src="/img/Linux/kms_05.png"></p><h2 id="三、激活Office"><a href="#三、激活Office" class="headerlink" title="三、激活Office"></a>三、激活Office</h2><ul><li><strong>还是用cmd管理员模式进入到安装office的目录</strong><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment">#进入安装目录</span><br>C:\Windows\system32&gt;<span class="hljs-keyword">cd</span> C:\Program Files\Microsoft Office\Office16<br><span class="hljs-comment">#指向服务器</span><br>cscript ospp.vbs <span class="hljs-string">/sethst</span><span class="hljs-function">:121.40.193.242</span><br><span class="hljs-comment">#手动激活</span><br>cscript ospp.vbs <span class="hljs-string">/act</span><br><span class="hljs-comment">#查询是否激活成功</span><br>cscript ospp.vbs <span class="hljs-string">/dstatus</span><br><span class="hljs-comment">#如果激活不成功，可以先查询然后把以前的key全部删除，在激活。</span><br>cscript ospp.vbs <span class="hljs-string">/unpkey</span><span class="hljs-function">:XXXXX</span><br></code></pre></td></tr></table></figure><img src="/img/Linux/kms_06.png"></li></ul>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kms、win10、office</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zabbix4.0安装Grafana插件(七)</title>
    <link href="/2021/03/30/zabbix/Zabbix4.0%E5%AE%89%E8%A3%85Grafana%E6%8F%92%E4%BB%B6(%E4%B8%83)/"/>
    <url>/2021/03/30/zabbix/Zabbix4.0%E5%AE%89%E8%A3%85Grafana%E6%8F%92%E4%BB%B6(%E4%B8%83)/</url>
    
    <content type="html"><![CDATA[<h2 id="一、Grafana简介"><a href="#一、Grafana简介" class="headerlink" title="一、Grafana简介"></a>一、Grafana简介</h2><p>1、Grafana是什么，其实我也不知道，我也是小白开始学习的，但是通过我的了解发现Grafana是个好牛逼的开源工具，他可以接入各种数据源，然后用酷炫的图给我们展示出来，然后我们可以理解当前的指标，当前服务的状况，总之很吊，反正我是要学会它的了。</p><p>2、Grafana常用的数据源有MySQL、Prometheus、AWS、还有Microsoft SQL Server、Oracle数据库等。<br>Grafana还支持多种告警模式，比如我知道的就有，Email、Telegram、钉钉等Webhook方式和，但监控与告警并非Grafana强项。</p><p>3、Grafana如何展示数据？ Grafana靠各种插件来展示数据，插件分原生(内置)插件和社区插件。原生插件包括：Graph(图形)、Singlestat(单值状态图)、Stat(状态图)、Gauge(仪表度量图)、Bar Gauge(条状态度量图)、Table(表格图)、Text(文本图)、Dashboard list(仪表列盘)、Plugin list(插件列表)、AlertList(告警列表图)等。</p><h2 id="二、安装Grafana"><a href="#二、安装Grafana" class="headerlink" title="二、安装Grafana"></a>二、安装Grafana</h2><ul><li>这边可以到<a href="https://grafana.com/grafana/download/6.7.3?pg=get&plcmt=selfmanaged-box1-cta1">官网</a>下载，有多个版本下载，我这边用的是7.1.5的版本</li></ul><p><img src="/img/zabbix/grafana_02.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@<span class="hljs-keyword">server</span> ~]# ls<br>anaconda-ks.cfg  grafana<span class="hljs-number">-7.1</span><span class="hljs-number">.5</span><span class="hljs-number">-1.</span>x86_64.rpm  graphfont.ttf  graphfont.ttf.bak  <span class="hljs-keyword">show</span>  use  zabbix-<span class="hljs-keyword">release</span><span class="hljs-number">-4.0</span><span class="hljs-number">-1.</span>el7.noarch.rpm<br>[root@<span class="hljs-keyword">server</span> ~]# yum -y install grafana<span class="hljs-number">-7.1</span><span class="hljs-number">.5</span><span class="hljs-number">-1.</span>x86_64.rpm <br><br>#设置开机自启动<br>[root@<span class="hljs-keyword">server</span> ~]# systemctl <span class="hljs-keyword">enable</span> grafana-<span class="hljs-keyword">server</span> <span class="hljs-comment">--now</span><br>Created symlink <span class="hljs-keyword">from</span> /etc/systemd/<span class="hljs-keyword">system</span>/multi-<span class="hljs-keyword">user</span>.target.wants/grafana-<span class="hljs-keyword">server</span>.service <span class="hljs-keyword">to</span> /usr/lib/systemd/<span class="hljs-keyword">system</span>/grafana-<span class="hljs-keyword">server</span>.service.<br>[root@<span class="hljs-keyword">server</span> ~]# netstat -tunlp | grep grafana<br>tcp6       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">3000</span>                 :::*                    <span class="hljs-keyword">LISTEN</span>      <span class="hljs-number">1646</span>/grafana-<span class="hljs-keyword">server</span> <br><br></code></pre></td></tr></table></figure><ul><li><strong>默认账户和密码都是admin</strong><br><img src="/img/zabbix/grafana_03.png"></li><li><strong>界面还是很高大上的，有没有</strong><br><img src="/img/zabbix/grafana_04.png"></li></ul><h2 id="三、Grafana接入zabbix"><a href="#三、Grafana接入zabbix" class="headerlink" title="三、Grafana接入zabbix"></a>三、Grafana接入zabbix</h2><ul><li><p><strong>我们可以在线安装插件，我查了下默认安装位置在/var/lib/grafana/plugins;插件安装后需要重启grafana-server，安装插件需要用到grafana的命令。</strong><br><strong>可以用以下命令查看grafana的命令是如何使用的</strong><br><img src="/img/zabbix/grafana_05.png"><br><img src="/img/zabbix/grafana_06.png"><br><img src="/img/zabbix/grafana_07.png"></p></li><li><p><strong>只有安装zabbix的插件了才可以在grafana中添加zabbix的数据源，使用zabbix的监控数据绘画出图形来</strong><br><img src="/img/zabbix/grafana_09.png"></p></li><li><p><strong>这里我找了一些常用的插件，有需要的可以用</strong></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">grafana-cli plugins <span class="hljs-keyword">install </span>alexanderzobnin-zabbix-app<br>grafana-cli plugins <span class="hljs-keyword">install </span>grafana-piechart-panel<br>grafana-cli plugins <span class="hljs-keyword">install </span>agenty-flowcharting-panel<br>grafana-cli plugins <span class="hljs-keyword">install </span>grafana-<span class="hljs-keyword">clock-panel</span><br><span class="hljs-keyword">grafana-cli </span>plugins <span class="hljs-keyword">install </span>pierosavi-imageit-panel<br>grafana-cli plugins <span class="hljs-keyword">install </span><span class="hljs-keyword">jdbranham-diagram-panel</span><br><span class="hljs-keyword">grafana-cli </span>plugins <span class="hljs-keyword">install </span>agenty-flowcharting-panel<br><br></code></pre></td></tr></table></figure></li></ul><h2 id="四、配置zabbix源"><a href="#四、配置zabbix源" class="headerlink" title="四、配置zabbix源"></a>四、配置zabbix源</h2><ul><li><p><strong>安装完alexanderzobnin-zabbix-app插件后，记得要重启grafana，然后才可以进行启用插件</strong></p><p><img src="/img/zabbix/grafana_10.png"><br><img src="/img/zabbix/grafana_11.png"><br><img src="/img/zabbix/grafana_12.png"></p></li><li><p><strong>这里添加zabbix的数据源,然后我第一次添加的时候找不到zabbix插件，查了一下，原因是因为我使用的grafana7.1.5版本的问题，要修改配置才启动才可以使用。</strong></p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[root@server plugins]</span><span class="hljs-comment"># vim /etc/grafana/grafana.ini </span><br><span class="hljs-attr">allow_loading_unsigned_plugins</span> = alexanderzobnin-zabbix-datasource<br><span class="hljs-section">[root@server plugins]</span><span class="hljs-comment"># systemctl restart grafana-server</span><br><br></code></pre></td></tr></table></figure><p> <img src="/img/zabbix/grafana_13.png"><br> <img src="/img/zabbix/grafana_14.png"><br> <img src="/img/zabbix/grafana_15.png"><br> <img src="/img/zabbix/grafana_16.png"></p><p> <strong>这里就成功在grafana下添加zabbix成功了 nice！ 又能愉快的操作了</strong></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Zabbix</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zabbix、grafana</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zabbix4.0配置自动发现规则（六）</title>
    <link href="/2021/03/23/zabbix/Zabbix4.0%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E5%8F%91%E7%8E%B0%E8%A7%84%E5%88%99(%E5%85%AD)/"/>
    <url>/2021/03/23/zabbix/Zabbix4.0%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E5%8F%91%E7%8E%B0%E8%A7%84%E5%88%99(%E5%85%AD)/</url>
    
    <content type="html"><![CDATA[<p>主机名        ip地址               功能<br>server      10.1.14.133        zabbix-server<br>agent2      10.1.14.30         zabbix-agent2 </p><h2 id="一、网络发现"><a href="#一、网络发现" class="headerlink" title="一、网络发现"></a>一、网络发现</h2><p>Zabbix定期扫描网络发现规则中定义的IP范围，并为每条规则单独配置了检测的频率，不用手动添加主机。<br>网络发现由两个阶段组成，发现和动作。</p><h2 id="二、创建自动发现规则"><a href="#二、创建自动发现规则" class="headerlink" title="二、创建自动发现规则"></a>二、创建自动发现规则</h2><ul><li><p>创建一个自动发现的规则<br><img src="/img/zabbix/zabbix_76.png"></p></li><li><p>我这里只选择了两个ip范围内<br><img src="/img/zabbix/zabbix_77.png"></p></li><li><p>agent下设置Server需要指向zabbix-server(安装agent这里就不说了)<br><img src="/img/zabbix/zabbix_78.png"></p></li><li><p>检查zabbix通过system.uname进行发现,检测成功。<br><img src="/img/zabbix/zabbix_79.png"></p></li></ul><h2 id="三、创建动作"><a href="#三、创建动作" class="headerlink" title="三、创建动作"></a>三、创建动作</h2><ul><li>选择自动发现然后创建动作<br><img src="/img/zabbix/zabbix_80.png"></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css">对新的触发条件进行配置，点击小添加，会生成响应条件<br><span class="hljs-selector-tag">A</span>：设置自动发现规则为已经设置好的刚刚设置的网络段<br><span class="hljs-selector-tag">B</span>：设置从发现主机之后的在线时间，默认单位秒<br>C：发现状态是up状态<br>D：服务类型是zabbix-agen<br><br></code></pre></td></tr></table></figure><ul><li>根据条件进行操作，这里选择我们刚刚前面创建好的条件。</li></ul><p><img src="/img/zabbix/zabbix_81.png"></p><ul><li>创建成功</li></ul><p><img src="/img/zabbix/zabbix_82.png"></p><h2 id="四、设置自动注册规则"><a href="#四、设置自动注册规则" class="headerlink" title="四、设置自动注册规则"></a>四、设置自动注册规则</h2><p>zabbix agent可以实现自动注册，进而服务器对其进行监控，通过这种方式，就不用在服务器上进行手动配置了，可以直接对新host进行监控。</p><ul><li><p>在zabbix agent客户端进行配置<br><img src="/img/zabbix/zabbix_83.png"></p></li><li><p>web端上创建自动注册规则<br><img src="/img/zabbix/zabbix_84.png"><br><img src="/img/zabbix/zabbix_85.png"><br><img src="/img/zabbix/zabbix_86.png"></p></li><li><p>这里可以重启下agent，检测自动注册上了<br><img src="/img/zabbix/zabbix_87.png"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Zabbix</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zabbix4.0前端报警媒介-企业微信报警（五）</title>
    <link href="/2021/03/20/zabbix/Zabbix4.0%E5%89%8D%E7%AB%AF%E6%8A%A5%E8%AD%A6%E5%AA%92%E4%BB%8B-%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%8A%A5%E8%AD%A6(%E4%BA%94)/"/>
    <url>/2021/03/20/zabbix/Zabbix4.0%E5%89%8D%E7%AB%AF%E6%8A%A5%E8%AD%A6%E5%AA%92%E4%BB%8B-%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%8A%A5%E8%AD%A6(%E4%BA%94)/</url>
    
    <content type="html"><![CDATA[<h2 id="一、注册企业微信企业号"><a href="#一、注册企业微信企业号" class="headerlink" title="一、注册企业微信企业号"></a>一、注册企业微信企业号</h2><p>这里我就略过了，网上很多教程，搜索一下就有了</p><h2 id="二、创建企业微信应用"><a href="#二、创建企业微信应用" class="headerlink" title="二、创建企业微信应用"></a>二、创建企业微信应用</h2><p>这里就我创建好了，大家也可以自己创建一下 动动手很快的事情<br><img src="/img/zabbix/zabbix_63.png"></p><h2 id="三、记录企业id-应用id"><a href="#三、记录企业id-应用id" class="headerlink" title="三、记录企业id,应用id"></a>三、记录企业id,应用id</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">CorpId</span>: wwa<span class="hljs-number">7286</span>c<span class="hljs-number">8</span>e<span class="hljs-number">57</span>ee<span class="hljs-number">83</span>bb<br><span class="hljs-attribute">AgentId</span>: <span class="hljs-number">1000004</span><br><span class="hljs-attribute">Secret</span>: n<span class="hljs-number">1</span>iE<span class="hljs-number">9</span>h<span class="hljs-number">1</span>GzioA<span class="hljs-number">8</span>DPh<span class="hljs-number">0</span>vXm<span class="hljs-number">0</span>gSgjkqJd<span class="hljs-number">1</span>T<span class="hljs-number">18</span>wwvjK<span class="hljs-number">4</span>aah<span class="hljs-number">4</span><br><br></code></pre></td></tr></table></figure><p><img src="/img/zabbix/zabbix_64.png"><br><img src="/img/zabbix/zabbix_65.png"></p><h2 id="四、企业微信接口调试"><a href="#四、企业微信接口调试" class="headerlink" title="四、企业微信接口调试"></a>四、<a href="https://open.work.weixin.qq.com/wwopen/devtool/interface/combine">企业微信接口调试</a></h2><p>如果检查完，回复Http 200 ok就说明没有问题了<br><img src="/img/zabbix/zabbix_66.png"></p><h2 id="五、准备企业微信报警媒介脚本"><a href="#五、准备企业微信报警媒介脚本" class="headerlink" title="五、准备企业微信报警媒介脚本"></a>五、准备企业微信报警媒介脚本</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment">#-*- coding: utf-8 -*-2.将脚本创建在报警脚本目录下</span><br>import requests<br>import sys<br>import os<br>import json<br>import logging<br>logging.basicConfig(level = logging.DEBUG, format = <span class="hljs-string">&#x27;%(asctime)s, %(filename)s,%(levelname)s, %(message)s&#x27;</span>,<br>datefmt = <span class="hljs-string">&#x27;%a, %d %b %Y %H:%M:%S&#x27;</span>,<br>filename = os.path.join(<span class="hljs-string">&#x27;/tmp&#x27;</span>,<span class="hljs-string">&#x27;weixin.log&#x27;</span>),<br>filemode = <span class="hljs-string">&#x27;a&#x27;</span>)<br><span class="hljs-comment">#企业id</span><br><span class="hljs-attribute">corpid</span>=<span class="hljs-string">&#x27;wwa7286c8e57ee83bb&#x27;</span><br><span class="hljs-comment">#应用密码</span><br><span class="hljs-attribute">appsecret</span>=<span class="hljs-string">&#x27;n1iE9h1GzioA8DPh0vXm0tsNV3m0Q6xbT__ldaLkURE&#x27;</span><br><span class="hljs-comment">#应用id</span><br><span class="hljs-attribute">agentid</span>=1000004<br><span class="hljs-comment">#获取accesstoken</span><br><span class="hljs-attribute">token_url</span>=<span class="hljs-string">&#x27;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=&#x27;</span> + corpid +<span class="hljs-string">&#x27;&amp;corpsecret=&#x27;</span> + appsecret <br><span class="hljs-attribute">req</span>=requests.get(token_url) <br><span class="hljs-attribute">accesstoken</span>=req.json()[<span class="hljs-string">&#x27;access_token&#x27;</span>]<br><span class="hljs-comment">#发送消息</span><br><span class="hljs-attribute">msgsend_url</span>=<span class="hljs-string">&#x27;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&#x27;</span> + accesstoken<br><span class="hljs-attribute">touser</span>=sys.argv[1]<br><span class="hljs-attribute">subject</span>=sys.argv[2]<br><span class="hljs-comment">#toparty=&#x27;3|4|5|6&#x27;</span><br><span class="hljs-attribute">message</span>=sys.argv[2] + <span class="hljs-string">&quot;\n\n&quot;</span> +sys.argv[3]<br><span class="hljs-comment">#需要传入三个参数</span><br>params=&#123;<br><span class="hljs-string">&quot;touser&quot;</span>: touser,<br><span class="hljs-comment"># &quot;toparty&quot;: toparty,</span><br><span class="hljs-string">&quot;msgtype&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br><span class="hljs-string">&quot;agentid&quot;</span>: agentid,<br><span class="hljs-string">&quot;text&quot;</span>: &#123;<br><span class="hljs-string">&quot;content&quot;</span>: message<br>&#125;,<br><span class="hljs-string">&quot;safe&quot;</span>:0<br>&#125; <br><span class="hljs-attribute">req</span>=requests.post(msgsend_url, <span class="hljs-attribute">data</span>=json.dumps(params))<br>logging.<span class="hljs-builtin-name">info</span>(<span class="hljs-string">&#x27;sendto:&#x27;</span> + touser + <span class="hljs-string">&#x27;;;subject:&#x27;</span> + subject + <span class="hljs-string">&#x27;;;message:&#x27;</span> + message)<br><br><span class="hljs-comment">#corpid=wwa7286c8e57ee83aa</span><br><span class="hljs-comment">#Agentld=1000004</span><br><span class="hljs-comment">#secret=n1iE9h1GzioA8DPh0vXm0qbnee7iorhjZCAxtDXggb4</span><br><span class="hljs-comment">#ge ren id =ChenDanTao</span><br><span class="hljs-comment">#[root@zabbix-server ~]# python monitoring_wxwork.py  &#x27;ChenDanTao&#x27; &#x27;可以吃饭了&#x27; &#x27;快下班吃饭把&#x27;</span><br><br><br></code></pre></td></tr></table></figure><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs elixir">[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># egrep -v &#x27;^#|^$&#x27; /etc/zabbix/zabbix_server.conf</span><br>AlertScriptsPath=<span class="hljs-regexp">/usr/lib</span><span class="hljs-regexp">/zabbix/alertscripts</span><br><br><span class="hljs-comment">#将脚本放到该目录下</span><br>[root<span class="hljs-variable">@server</span> alertscripts]<span class="hljs-comment"># ls</span><br>monitoring_wxwork.py<br><br><span class="hljs-comment">#需要安装requests包</span><br>[root<span class="hljs-variable">@server</span> alertscripts]<span class="hljs-comment"># python monitoring_wxwork.py </span><br>Traceback (most recent call last)<span class="hljs-symbol">:</span><br>  File <span class="hljs-string">&quot;monitoring_wxwork.py&quot;</span>, line <span class="hljs-number">5</span>, <span class="hljs-keyword">in</span> &lt;<span class="hljs-keyword">module</span>&gt;<br>    <span class="hljs-keyword">import</span> requests<br><span class="hljs-symbol">ImportError:</span> No <span class="hljs-keyword">module</span> named requests<br>[root<span class="hljs-variable">@server</span> alertscripts]<span class="hljs-comment">#</span><br><br><span class="hljs-comment">#先安装python-pip,然后再用pip安装requests即可</span><br><br>[root<span class="hljs-variable">@server</span> alertscripts]<span class="hljs-comment"># yum -y install python-pip</span><br><span class="hljs-comment">#临时使用清华源加速下载包</span><br>[root<span class="hljs-variable">@server</span> alertscripts]<span class="hljs-comment"># pip install -i https://pypi.tuna.tsinghua.edu.cn/simple requests</span><br><br><span class="hljs-comment">#给脚本加权限并执行</span><br>[root<span class="hljs-variable">@server</span> alertscripts]<span class="hljs-comment"># chmod +x monitoring_wxwork.py</span><br><span class="hljs-comment">#执行脚本</span><br>[root<span class="hljs-variable">@server</span> alertscripts]<span class="hljs-comment"># python monitoring_wxwork.py</span><br><br></code></pre></td></tr></table></figure><p><strong>报警成功</strong></p><p><img src="/img/zabbix/zabbix_67.png"></p><h2 id="六、在web端设置自动企业微信报警"><a href="#六、在web端设置自动企业微信报警" class="headerlink" title="六、在web端设置自动企业微信报警"></a>六、在web端设置自动企业微信报警</h2><ul><li>首先还是定义发件人，创建一个企业微信报警媒介</li></ul><p><img src="/img/zabbix/zabbix_68.png"><br><img src="/img/zabbix/zabbix_69.png"></p><ul><li>然后定义收件人，不然出问题谁会知道呢</li></ul><p><img src="/img/zabbix/zabbix_70.png"><br><img src="/img/zabbix/zabbix_71.png"><br><img src="/img/zabbix/zabbix_72.png"></p><ul><li>然后执行测试命令，看下是否正常能发送,连续测试了两次，都报了以下错误<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@server alertscripts]# cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> &amp;<br>[root@server alertscripts]# cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> &amp;<br>[root@server alertscripts]# cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> &amp;<br>[root@server alertscripts]# cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> &amp;<br><br></code></pre></td></tr></table></figure><img src="/img/zabbix/zabbix_73.png"><br><img src="/img/zabbix/zabbix_74.png"></li></ul><p>第一个图片的解决方法<a href="https://blog.csdn.net/zhengzaifeidelushang/article/details/106871440">在这里</a><br>第二个图片的解决方法</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mel">#修改<span class="hljs-keyword">log</span>的用户和组<br>[root@server alertscripts]# <span class="hljs-keyword">ls</span> -ld /tmp/weixin.<span class="hljs-keyword">log</span> <br>-rw-r--r--. <span class="hljs-number">1</span> root root <span class="hljs-number">927</span> Mar <span class="hljs-number">21</span> <span class="hljs-number">01</span>:<span class="hljs-number">49</span> /tmp/weixin.<span class="hljs-keyword">log</span><br>[root@server alertscripts]# chown zabbix:zabbix /tmp/weixin.<span class="hljs-keyword">log</span><br><br></code></pre></td></tr></table></figure><ul><li>然后再执行测试就可以正常企业微信和邮件都收到了!</li></ul><p><img src="/img/zabbix/zabbix_75.png"></p>]]></content>
    
    
    <categories>
      
      <category>Zabbix</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zabbix4.0前端报警媒介-qq邮件报警（四）</title>
    <link href="/2021/03/19/zabbix/Zabbix4.0%E5%89%8D%E7%AB%AF%E6%8A%A5%E8%AD%A6%E5%AA%92%E4%BB%8B-%E9%82%AE%E4%BB%B6%E6%8A%A5%E8%AD%A6(%E5%9B%9B)/"/>
    <url>/2021/03/19/zabbix/Zabbix4.0%E5%89%8D%E7%AB%AF%E6%8A%A5%E8%AD%A6%E5%AA%92%E4%BB%8B-%E9%82%AE%E4%BB%B6%E6%8A%A5%E8%AD%A6(%E5%9B%9B)/</url>
    
    <content type="html"><![CDATA[<h2 id="一、报警前提-zabbix-server必须能访问internet"><a href="#一、报警前提-zabbix-server必须能访问internet" class="headerlink" title="一、报警前提,zabbix-server必须能访问internet"></a>一、报警前提,zabbix-server必须能访问internet</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros">1.zabbix-server必须能访问internet,保证server可以和外界的SMTP（邮件传输协议25端口）服务器建立连接。<br>2.必须具备一个能发邮件的邮箱<br>3.必须确定要给谁发邮件<br><br>[root@server ~]#<span class="hljs-built_in"> ping </span>-c 1 mail.qq.com<br>PING v6.mail.qq.com (14.18.245.237) 56(84) bytes of data.<br>64 bytes <span class="hljs-keyword">from</span> 14.18.245.237 (14.18.245.237): <span class="hljs-attribute">icmp_seq</span>=1 <span class="hljs-attribute">ttl</span>=54 <span class="hljs-attribute">time</span>=3.30 ms<br><br>--- v6.mail.qq.com<span class="hljs-built_in"> ping </span>statistics ---<br>1 packets transmitted, 1 received, 0% packet loss, time 0ms<br>rtt min/avg/max/mdev = 3.303/3.303/3.303/0.000 ms<br>[root@server ~]# <br></code></pre></td></tr></table></figure><h2 id="二、zabbix设置告警的完整流程"><a href="#二、zabbix设置告警的完整流程" class="headerlink" title="二、zabbix设置告警的完整流程"></a>二、zabbix设置告警的完整流程</h2><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-number">1</span>.添加用户组(添加权限)权限只能按用户分配<br><span class="hljs-number">2</span>.添加用户(选择用户类型、用户、管理员、超级管理员、添加报警媒介)<br><span class="hljs-number">3</span>.在<span class="hljs-string">&quot;管理&gt;报警媒介类型&quot;</span>中设置好报警媒介<br><span class="hljs-number">4</span>.启动<span class="hljs-built_in">action</span>，在<span class="hljs-string">&quot;配置&gt;动作&quot;</span>中启用,并配置操作<br></code></pre></td></tr></table></figure><h2 id="三、zabbix设置邮件报警大体可以分为两大类"><a href="#三、zabbix设置邮件报警大体可以分为两大类" class="headerlink" title="三、zabbix设置邮件报警大体可以分为两大类"></a>三、zabbix设置邮件报警大体可以分为两大类</h2><ul><li><strong>使用外部邮箱账号发送报警邮件设置</strong><ul><li>Email</li><li>自定义脚本</li></ul></li><li><strong>使用zabbix服务端本地邮箱账号发送邮件</strong></li></ul><p><strong>1、使用QQ邮箱发送报警邮件</strong></p><ul><li>登录mail.qq.com获取QQ邮箱的授权码</li></ul><p><img src="/img/zabbix/zabbix_51.png"><br><img src="/img/zabbix/zabbix_52.png"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#安装sendmail和mailx软件</span><br>[root@server ~]# yum -y install sendmail mailx<br><span class="hljs-comment">#开启sendmail服务</span><br>[root@server ~]# systemctl <span class="hljs-builtin-name">enable</span> sendmail --now<br>[root@server etc]# cp mail.rc mail2.rc<br>[root@server etc]# mv mail.rc mail.rc.bak<br>[root@server etc]# mv mail2.rc mail.rc<br><br><br><span class="hljs-comment">#配置sendmail客户端邮件配置</span><br>[root@server etc]# cat mail.rc<br><span class="hljs-builtin-name">set</span> <span class="hljs-attribute">from</span>=lmxi_dei@qq.com<br><span class="hljs-builtin-name">set</span> <span class="hljs-attribute">smtp</span>=smtp.qq.com<br><span class="hljs-builtin-name">set</span> <span class="hljs-attribute">smtp-auth-user</span>=lmxi_dei@qq.com<br><span class="hljs-comment">#password是qq邮箱的授权码，并不是qq密码</span><br><span class="hljs-builtin-name">set</span> <span class="hljs-attribute">smtp-auth-password</span>=xlxildjofkexwerf<br><span class="hljs-builtin-name">set</span> <span class="hljs-attribute">smtp-auth</span>=login<br>[root@server etc]# <br><br><span class="hljs-comment">#邮件发送测试</span><br>[root@server etc]# echo <span class="hljs-string">&#x27;zabbix邮件主题告警&#x27;</span> | mail -s <span class="hljs-string">&#x27;邮件测试第一次&#x27;</span> lemonchen@lexin.com<br><br></code></pre></td></tr></table></figure><p><img src="/img/zabbix/zabbix_53.png"></p><p><strong>2、在zabbix-web上设置邮件报警媒介</strong></p><ul><li>这里我们首先设置发件人,设置报警媒介，我们选择电子邮件报警</li></ul><p><img src="/img/zabbix/zabbix_54.png"><br><img src="/img/zabbix/zabbix_55.png"></p><ul><li>设置完发件人以后，需要设置收件人，收件人可以填多个，这里我就填自己的，大家不要给我炸我邮箱了哈哈</li></ul><p><img src="/img/zabbix/zabbix_56.png"></p><ul><li>发件人和收件人都设置完了，这时候需要有一个动作，当设置的值高于阈值的时候，有一个动作产生报警</li></ul><p><img src="/img/zabbix/zabbix_57.png"></p><p>这里的报警内容，可以做修改(<a href="https://www.zabbix.com/documentation/4.0/zh/manual/appendix/macros/supported_by_location">https://www.zabbix.com/documentation/4.0/zh/manual/appendix/macros/supported_by_location</a>)</p><ul><li>操作发送报警的内容</li></ul><p><img src="/img/zabbix/zabbix_58.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml">zabbix报警名称: </span><span class="hljs-template-variable">&#123;EVENT.NAME&#125;</span><br><span class="xml">告警主机：</span><span class="hljs-template-variable">&#123;HOSTNAME1&#125;</span><br><span class="xml">告警地址：</span><span class="hljs-template-variable">&#123;HOST.IP&#125;</span><br><span class="xml">告警时间：</span><span class="hljs-template-variable">&#123;EVENT.DATE&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;EVENT.TIME&#125;</span><br><span class="xml">告警等级：</span><span class="hljs-template-variable">&#123;TRIGGER.SEVERITY&#125;</span><br><span class="xml">告警信息：</span><span class="hljs-template-variable">&#123;TRIGGER.NAME&#125;</span><br><span class="xml">告警项目：</span><span class="hljs-template-variable">&#123;TRIGGER.KEY1&#125;</span><br><span class="xml">问题详情：</span><span class="hljs-template-variable">&#123;ITEM.NAME&#125;</span><span class="xml">:</span><span class="hljs-template-variable">&#123;ITEM.VAULE&#125;</span><br><span class="xml">当前状态：Error</span><br><span class="xml">事件ID：</span><span class="hljs-template-variable">&#123;EVENT.ID&#125;</span><br><br></code></pre></td></tr></table></figure><ul><li>恢复操作报警的内容<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml">zabbix恢复名称: </span><span class="hljs-template-variable">&#123;EVENT.NAME&#125;</span><br><span class="xml">已恢复主机：</span><span class="hljs-template-variable">&#123;HOSTNAME1&#125;</span><br><span class="xml">已恢复地址：</span><span class="hljs-template-variable">&#123;HOST.IP&#125;</span><br><span class="xml">已恢复时间：</span><span class="hljs-template-variable">&#123;EVENT.DATE&#125;</span><span class="xml"> </span><span class="hljs-template-variable">&#123;EVENT.TIME&#125;</span><br><span class="xml">已恢复信息：</span><span class="hljs-template-variable">&#123;TRIGGER.NAME&#125;</span><br><span class="xml">已恢复项目：</span><span class="hljs-template-variable">&#123;TRIGGER.KEY1&#125;</span><br><span class="xml">已恢复详情：</span><span class="hljs-template-variable">&#123;ITEM.NAME&#125;</span><span class="xml">:</span><span class="hljs-template-variable">&#123;ITEM.VAULE&#125;</span><br><span class="xml">当前状态：true</span><br><span class="xml">事件ID：</span><span class="hljs-template-variable">&#123;EVENT.ID&#125;</span><br><br></code></pre></td></tr></table></figure></li></ul><p><img src="/img/zabbix/zabbix_59.png"></p><ul><li>测试报警结果图<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@server etc]# cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> &amp;<br>[root@server etc]# cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> &amp;<br>[root@server etc]# cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> &amp;<br>[root@server etc]# cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> &amp;<br><br></code></pre></td></tr></table></figure><img src="/img/zabbix/zabbix_60.png"></li></ul><ul><li>自动恢复报警<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@server etc]# pkill cat<br>[<span class="hljs-number">7</span>]   Terminated              cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span><br>[<span class="hljs-number">9</span>]   Terminated              cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span><br>[<span class="hljs-number">8</span>]   Terminated              cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span><br>[<span class="hljs-number">11</span>]   Terminated              cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span><br><br></code></pre></td></tr></table></figure><img src="/img/zabbix/zabbix_61.png"></li></ul><p>这里能做恢复是因为之前我们前面触发器设置了恢复表达式小于0.7就恢复<br><img src="/img/zabbix/zabbix_62.png"></p>]]></content>
    
    
    <categories>
      
      <category>Zabbix</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zabbix4.0添加主机监控（三）</title>
    <link href="/2021/03/16/zabbix/Zabbix4.0%E6%B7%BB%E5%8A%A0%E4%B8%BB%E6%9C%BA%E7%9B%91%E6%8E%A7(%E4%B8%89)/"/>
    <url>/2021/03/16/zabbix/Zabbix4.0%E6%B7%BB%E5%8A%A0%E4%B8%BB%E6%9C%BA%E7%9B%91%E6%8E%A7(%E4%B8%89)/</url>
    
    <content type="html"><![CDATA[<h2 id="一、安装zabbix-agent"><a href="#一、安装zabbix-agent" class="headerlink" title="一、安装zabbix-agent"></a>一、安装zabbix-agent</h2><p><strong>1、设置软件仓库</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment">#下载源</span><br><span class="hljs-section">[root@agent1 ~]</span><span class="hljs-comment"># wget http://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span><br><span class="hljs-section">[root@agent1 ~]</span><span class="hljs-comment"># rpm -ivh zabbix-release-4.0-1.el7.noarch.rpm </span><br><br><span class="hljs-comment">#更换源</span><br><span class="hljs-section">[root@agent1 ~]</span><span class="hljs-comment"># cat /etc/yum.repos.d/zabbix.repo </span><br><span class="hljs-section">[zabbix]</span><br><span class="hljs-attr">name</span>=Zabbix <span class="hljs-literal">Off</span>icial Repository - <span class="hljs-variable">$basearch</span><br><span class="hljs-attr">baseurl</span>=https://mirror.tuna.tsinghua.edu.cn/zabbix/zabbix/<span class="hljs-number">4.0</span>/rhel/<span class="hljs-number">7</span>/<span class="hljs-variable">$basearch</span>/<br><span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">gpgkey</span>=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591<br><br><span class="hljs-section">[zabbix-non-supported]</span><br><span class="hljs-attr">name</span>=Zabbix <span class="hljs-literal">Off</span>icial Repository non-supported - <span class="hljs-variable">$basearch</span> <br><span class="hljs-attr">baseurl</span>=https://mirror.tuna.tsinghua.edu.cn/zabbix/non-supported/rhel/<span class="hljs-number">7</span>/<span class="hljs-variable">$basearch</span>/<br><span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">gpgkey</span>=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX<br><span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">0</span><br><span class="hljs-section">[root@agent1 ~]</span><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p><strong>2、安装zabbix-agent</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@agent1</span> ~]<span class="hljs-meta"># yum -y install zabbix-agent</span><br><br></code></pre></td></tr></table></figure><p><strong>3、修改zabbix-agent的配置文件</strong></p><p>我们要在zabbix-agent上修改配置文件，让我们的zabbix-agent允许zabbix-server获取数据。<br>zabbix server通过agent获取数据有两种模式，一种是agent端主动发送数据到server端，我们称之为<br>主动模式，agent端等待server提取数据，叫做被动模式，两种模式可以一起配置并不冲突。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br>[root@agent1 ~]<span class="hljs-comment"># sed -i &#x27;s/Server=127.0.0.1/Server=10.1.14.133/&#x27; /etc/zabbix/zabbix_agentd.conf </span><br>[root@agent1 ~]<span class="hljs-comment"># sed -i &#x27;s/ServerActive=127.0.0.1/ServerActive=10.1.14.133/&#x27; /etc/zabbix/zabbix_agentd.conf </span><br><span class="hljs-comment">#放行了端口</span><br>[root@agent1 ~]<span class="hljs-comment"># firewall-cmd --list-ports</span><br><span class="hljs-number">10050</span>/tcp<br>[root@agent1 ~]<span class="hljs-comment">#</span><br><br>[root@agent1 ~]<span class="hljs-comment"># egrep -v &#x27;^#|^$&#x27; /etc/zabbix/zabbix_agentd.conf </span><br>PidFile=<span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/zabbix/</span>zabbix_agentd.pid<br>LogFile=<span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/zabbix/</span>zabbix_agentd.log<br>LogFileSize=<span class="hljs-number">0</span><br><span class="hljs-comment">#Server表示允许那个主机获取我这里的数据</span><br>Server=<span class="hljs-number">10.1</span>.<span class="hljs-number">14.133</span><br>ListenPort=<span class="hljs-number">10050</span><br><span class="hljs-comment">#监听自己的客户端</span><br>ListenIP=<span class="hljs-number">10.1</span>.<span class="hljs-number">14.29</span><br><span class="hljs-comment">#ServerActive表示主动向那个主机发送数据</span><br>ServerActive=<span class="hljs-number">10.1</span>.<span class="hljs-number">14.133</span><br>Hostname=<span class="hljs-number">10.1</span>.<span class="hljs-number">14.29</span><br>Include=<span class="hljs-regexp">/etc/</span>zabbix<span class="hljs-regexp">/zabbix_agentd.d/</span>*.conf<br>[root@agent1 ~]<span class="hljs-comment"># </span><br><br><br><span class="hljs-comment">#重启zabbix-agent服务</span><br>[root@agent1 ~]<span class="hljs-comment"># netstat -lntup | grep agent</span><br>[root@agent1 ~]<span class="hljs-comment"># systemctl enable zabbix-agent --now</span><br>Created symlink from <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/mu</span>lti-user.target.wants<span class="hljs-regexp">/zabbix-agent.service to /u</span>sr<span class="hljs-regexp">/lib/</span>systemd<span class="hljs-regexp">/system/</span>zabbix-agent.service.<br>[root@agent1 ~]<span class="hljs-comment"># netstat -lntup | grep agent</span><br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">10050</span>           <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:*               LISTEN      <span class="hljs-number">19622</span>/zabbix_agentd <br>tcp6       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">10050</span>                :::*                    LISTEN      <span class="hljs-number">19622</span>/zabbix_agentd<br><br><br><br></code></pre></td></tr></table></figure><h2 id="二、测试连接"><a href="#二、测试连接" class="headerlink" title="二、测试连接"></a>二、测试连接</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta">#用zabbix-server测试是否能get到zabbix-agent的数据</span><br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># zabbix_get -s 10.1.14.29 -p 10050 -k <span class="hljs-string">&quot;system.cpu.load[all,avg1]&quot;</span></span><br><span class="hljs-number">0.000000</span><br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># </span><br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># zabbix_get -s 10.1.14.29 -p 10050 -k <span class="hljs-string">&quot;system.hostname&quot;</span></span><br>agent1<br></code></pre></td></tr></table></figure><h2 id="三、创建主机、关联模板、监控项、触发器、图形和模板"><a href="#三、创建主机、关联模板、监控项、触发器、图形和模板" class="headerlink" title="三、创建主机、关联模板、监控项、触发器、图形和模板"></a>三、创建主机、关联模板、监控项、触发器、图形和模板</h2><p><img src="/img/zabbix/zabbix_12.png"></p><p><strong>4、创建主机群组并创建主机</strong><br><img src="/img/zabbix/zabbix_13.png"><br><img src="/img/zabbix/zabbix_14.png"><br><img src="/img/zabbix/zabbix_15.png"><br><img src="/img/zabbix/zabbix_16.png"><br><img src="/img/zabbix/zabbix_17.png"></p><p><strong>5、关联模板并关联监控项，创建图形查看图形</strong></p><p><img src="/img/zabbix/zabbix_18.png"><br><img src="/img/zabbix/zabbix_19.png"><br><img src="/img/zabbix/zabbix_20.png"><br><img src="/img/zabbix/zabbix_21.png"><br><img src="/img/zabbix/zabbix_22.png"><br><img src="/img/zabbix/zabbix_23.png"></p><p><strong>6、示例,创建监控项节点过去1分钟cpu的负载</strong><br>把原来的zabbix-server添加进来，这样才可以做监控<br><img src="/img/zabbix/zabbix_24.png"><br><img src="/img/zabbix/zabbix_25.png"><br><img src="/img/zabbix/zabbix_26.png"><br><img src="/img/zabbix/zabbix_27.png"><br><img src="/img/zabbix/zabbix_28.png"></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#在zabbix-server上安装zabbix-agent<br>[root@server ~]# yum -y install zabbix-agent<br>#修改zabbix-agent的配置文件<br>[root@server ~]# sed -i <span class="hljs-string">&#x27;s/Server=127.0.0.1/Server=10.1.14.133/&#x27;</span> <span class="hljs-regexp">/etc/</span>zabbix/zabbix_agentd.conf<br>[root@server ~]# sed -i <span class="hljs-string">&#x27;s/ServerActive=127.0.0.1/ServerActive=10.1.14.133/&#x27;</span> <span class="hljs-regexp">/etc/</span>zabbix/zabbix_agentd.conf <br>[root@server ~]# egrep -v <span class="hljs-string">&#x27;^#|^$&#x27;</span> <span class="hljs-regexp">/etc/</span>zabbix/zabbix_agentd.conf<br>PidFile=<span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/zabbix/</span>zabbix_agentd.pid<br>LogFile=<span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/zabbix/</span>zabbix_agentd.log<br>LogFileSize=<span class="hljs-number">0</span><br>Server=<span class="hljs-number">10.1</span>.<span class="hljs-number">14.133</span><br>ServerActive=<span class="hljs-number">10.1</span>.<span class="hljs-number">14.133</span><br>Hostname=Zabbix server<br><span class="hljs-keyword">Include</span>=<span class="hljs-regexp">/etc/</span>zabbix<span class="hljs-regexp">/zabbix_agentd.d/</span>*.conf<br>[root@server ~]# <br><br>#zabbix-agent服务重启<br>[root@server ~]# systemctl enable zabbix-agent --now<br>Created symlink <span class="hljs-keyword">from</span> <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/mu</span>lti-user.target.wants<span class="hljs-regexp">/zabbix-agent.service to /u</span>sr<span class="hljs-regexp">/lib/</span>systemd<span class="hljs-regexp">/system/</span>zabbix-agent.service.<br>[root@server ~]# netstat -tunlp | <span class="hljs-keyword">grep</span> agent<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">10050</span>           <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:*               LISTEN      <span class="hljs-number">12378</span>/zabbix_agentd <br>tcp6       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">10050</span>                :::*                    LISTEN      <span class="hljs-number">12378</span>/zabbix_agentd <br>[root@server ~]# <br></code></pre></td></tr></table></figure><p>此时在web上看主机的监控可用性，已经变成绿色的了。<br><img src="/img/zabbix/zabbix_29.png"></p><p><strong>7、示例,设置监控图形</strong></p><p>由于监控图形的数据来自于监控项，如果没有监控项，那么就没有数据来源，没有数据来源则无法检测！<br><img src="/img/zabbix/zabbix_31.png"><br><img src="/img/zabbix/zabbix_32.png"><br><img src="/img/zabbix/zabbix_33.png"><br>此时看到字体是乱码的，这时候我们需要重新设置字体<br><img src="/img/zabbix/zabbix_34.png"></p><p><strong>8、修复图形字体的乱码问题</strong><br><img src="/img/zabbix/zabbix_35.png"><br><img src="/img/zabbix/zabbix_36.png"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># ls /usr/share/zabbix/assets/fonts/</span><br>graphfont.ttf  STXINWEI.TTF<br>[root<span class="hljs-symbol">@server</span> fonts]<span class="hljs-meta"># mv graphfont.ttf  graphfont.ttf.bak</span><br>[root<span class="hljs-symbol">@server</span> fonts]<span class="hljs-meta"># mv STXINWEI.TTF graphfont.ttf</span><br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># </span><br><br></code></pre></td></tr></table></figure><p><strong>此时在查看图形</strong><br><img src="/img/zabbix/zabbix_37.png"></p><p><strong>7、示例,创建触发器</strong><br><img src="/img/zabbix/zabbix_38.png"><br><img src="/img/zabbix/zabbix_39.png"><br><img src="/img/zabbix/zabbix_40.png"><br><img src="/img/zabbix/zabbix_41.png"><br><img src="/img/zabbix/zabbix_42.png"></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">&#123;<span class="hljs-number">10.1</span>.<span class="hljs-number">14.133</span>:system<span class="hljs-selector-class">.cpu</span><span class="hljs-selector-class">.load</span><span class="hljs-selector-attr">[all,avg1]</span><span class="hljs-selector-class">.last</span>(#<span class="hljs-number">1</span>,<span class="hljs-number">20</span>)&#125;&gt;<span class="hljs-number">0.7</span><br><span class="hljs-number">10.1</span>.<span class="hljs-number">14.133</span>表示主机<br>system<span class="hljs-selector-class">.cpu</span><span class="hljs-selector-class">.load</span><span class="hljs-selector-attr">[all,avg1]</span>表示键值<br><span class="hljs-function"><span class="hljs-title">last</span><span class="hljs-params">(#<span class="hljs-number">1</span>,<span class="hljs-number">20</span>)</span></span>表示last函数，最后的<span class="hljs-number">1</span>个值，持续<span class="hljs-number">20s</span><br>&gt;<span class="hljs-number">0.7</span>表示last函数的取值如果大于<span class="hljs-number">0.7</span>，那么触发器就生效<br><br></code></pre></td></tr></table></figure><p><img src="/img/zabbix/zabbix_43.png"><br><img src="/img/zabbix/zabbix_44.png"><br><img src="/img/zabbix/zabbix_45.png"></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#手动提高主机的cpu负载，然后可以观察触发器的报警<br>[root@server ~]# cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> &amp;<br>[<span class="hljs-number">1</span>] <span class="hljs-number">14834</span><br>[root@server ~]# cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> &amp;<br>[<span class="hljs-number">2</span>] <span class="hljs-number">14836</span><br>[root@server ~]# cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> &amp;<br>[<span class="hljs-number">3</span>] <span class="hljs-number">14837</span><br>root@server ~]# watch -n3 uptime<br><br></code></pre></td></tr></table></figure><p><img src="/img/zabbix/zabbix_46.png"></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#当触发器检测到监控项的值变低了，就会自动解决问题<br>[root@server ~]# pkill cat<br>[<span class="hljs-number">1</span>]   Terminated              cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span><br>[<span class="hljs-number">3</span>]-  Terminated              cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span><br>[<span class="hljs-number">2</span>]-  Terminated              cat <span class="hljs-regexp">/dev/</span>zero &gt;&gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span><br><br></code></pre></td></tr></table></figure><p><img src="/img/zabbix/zabbix_47.png"></p><p><strong>8、示例,将触发器应用到别的主机上</strong></p><p><img src="/img/zabbix/zabbix_48.png"><br><img src="/img/zabbix/zabbix_49.png"><br><img src="/img/zabbix/zabbix_50.png"></p>]]></content>
    
    
    <categories>
      
      <category>Zabbix</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zabbix4.0环境搭建（二）</title>
    <link href="/2021/03/15/zabbix/Zabbix4.0%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA(%E4%BA%8C)/"/>
    <url>/2021/03/15/zabbix/Zabbix4.0%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA(%E4%BA%8C)/</url>
    
    <content type="html"><![CDATA[<h2 id="一、实验准备"><a href="#一、实验准备" class="headerlink" title="一、实验准备"></a>一、实验准备</h2><p><strong>这里只做实验演练准备,Centos7三台台，一台为监控服务器，两台座位被监控节点。</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">zabbix</span>-server <span class="hljs-number">192.168.100.101</span><br><span class="hljs-attribute">zabbix</span>-agent <span class="hljs-number">192.168.100.102</span><br><span class="hljs-attribute">zabbix</span>-agent <span class="hljs-number">192.168.100.103</span><br></code></pre></td></tr></table></figure><h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><p>1、<strong>zabbix-server搭建</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#关闭SELINUX</span><br><br>[root@server ~]<span class="hljs-comment"># sed -i &#x27;s/SELINUX=enforcing/SELINUX=permissive/&#x27; /etc/selinux/config </span><br>[root@server ~]<span class="hljs-comment"># setenforce 0</span><br>[root@server ~]<span class="hljs-comment"># getenforce</span><br>Permissive<br>[root@server ~]<span class="hljs-comment"># </span><br><br><span class="hljs-comment">#配置zabbix yum仓库</span><br><br>[root@server ~]<span class="hljs-comment"># wget http://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span><br>[root@server ~]<span class="hljs-comment"># rpm -ivh zabbix-release-4.0-1.el7.noarch.rpm</span><br><br><span class="hljs-comment">#更换源</span><br>[root@server ~]<span class="hljs-comment"># cat /etc/yum.repos.d/zabbix.repo </span><br>[zabbix]<br>name=Zabbix Official Repository - <span class="hljs-variable">$basearch</span><br>baseurl=https:<span class="hljs-regexp">//mi</span>rror.tuna.tsinghua.edu.cn<span class="hljs-regexp">/zabbix/</span>zabbix<span class="hljs-regexp">/4.0/</span>rhel<span class="hljs-regexp">/7/</span><span class="hljs-variable">$basearch</span>/<br>enabled=<span class="hljs-number">1</span><br>gpgcheck=<span class="hljs-number">0</span><br>gpgkey=file:<span class="hljs-regexp">//</span><span class="hljs-regexp">/etc/</span>pki<span class="hljs-regexp">/rpm-gpg/</span>RPM-GPG-KEY-ZABBIX-A14FE591<br><br>[zabbix-non-supported]<br>name=Zabbix Official Repository non-supported - <span class="hljs-variable">$basearch</span> <br>baseurl=https:<span class="hljs-regexp">//mi</span>rror.tuna.tsinghua.edu.cn<span class="hljs-regexp">/zabbix/</span>non-supported<span class="hljs-regexp">/rhel/</span><span class="hljs-number">7</span><span class="hljs-regexp">/$basearch/</span><br>enabled=<span class="hljs-number">1</span><br>gpgkey=file:<span class="hljs-regexp">//</span><span class="hljs-regexp">/etc/</span>pki<span class="hljs-regexp">/rpm-gpg/</span>RPM-GPG-KEY-ZABBIX<br>gpgcheck=<span class="hljs-number">0</span><br>[root@server ~]<span class="hljs-comment"># </span><br><br><span class="hljs-comment">#安装zabbix-server服务端及zabbix-web前端和mariadb数据库</span><br>[root@server ~]<span class="hljs-comment"># yum -y install zabbix-server-mysql zabbix-web-mysql mariadb-server</span><br><br><span class="hljs-comment">#启动数据库并设置下次启动，如果不做这个操作，你的数据库就是没有密码的，默认数据库会创建一个root的用户，而且这个root用户是</span><br>管理员且没有密码<br>[root@server ~]<span class="hljs-comment"># systemctl enable mariadb --now</span><br><br><span class="hljs-comment">#初始化数据库</span><br>[root@server ~]<span class="hljs-comment"># mysql_secure_installation</span><br><br><span class="hljs-comment">#测试连接</span><br>[root@server ~]<span class="hljs-comment"># mysql -uroot -p123456 -hlocalhost</span><br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MariaDB connection id is <span class="hljs-number">10</span><br>Server version: <span class="hljs-number">5.5</span>.<span class="hljs-number">68</span>-MariaDB MariaDB Server<br><br><br><span class="hljs-comment">#创建一个zabbix的数据库并且设置一个专门的用户访问zabbix数据库的用户</span><br>MariaDB [(none)]&gt; create database zabbix character set utf8 collate utf8_bin;<br>MariaDB [(none)]&gt; grant all privileges on zabbix.* to zabbix@<span class="hljs-string">&#x27;%&#x27;</span> identified by <span class="hljs-string">&#x27;zabbix&#x27;</span>;<br>MariaDB [(none)]&gt; flush privileges;<br>MariaDB [zabbix]&gt; use zabbix;<br>MariaDB [zabbix]&gt; show tables;<br><br><span class="hljs-comment">#前面我们已经安装过zabbix-server-mysql软件了，现在将软件提供的zabbix数据库模板导入新建的zabbix数据库，因为该软件提供了zabbix数据库模板，里面包含了表</span><br>root@server ~]<span class="hljs-comment"># ls /usr/share/doc/zabbix-server-mysql-4.0.29/create.sql.gz </span><br><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/doc/</span>zabbix-server-mysql-<span class="hljs-number">4.0</span>.<span class="hljs-number">29</span>/create.sql.gz<br><span class="hljs-comment">#将模板导入数据库</span><br>[root@server ~]<span class="hljs-comment"># zcat /usr/share/doc/zabbix-server-mysql-4.0.29/create.sql.gz  | mysql -uzabbix -pzabbix zabbix</span><br><span class="hljs-comment">#检查</span><br>[root@server ~]<span class="hljs-comment"># mysql -uzabbix -pzabbix -e &quot;use zabbix;&quot; -e &quot;show tables;&quot;</span><br><br><span class="hljs-comment">#配置zabbix-server</span><br>[root@server ~]<span class="hljs-comment"># egrep -v &#x27;^#|^$&#x27; /etc/zabbix/zabbix_server.conf </span><br>LogFile=<span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/zabbix/</span>zabbix_server.log<br>LogFileSize=<span class="hljs-number">0</span><br>PidFile=<span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/zabbix/</span>zabbix_server.pid<br>SocketDir=<span class="hljs-regexp">/var/</span>run/zabbix<br>DBHost=localhost<br>DBName=zabbix<br>DBUser=zabbix<br>DBPassword=zabbix<br>SNMPTrapperFile=<span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/snmptrap/</span>snmptrap.log<br>Timeout=<span class="hljs-number">4</span><br>AlertScriptsPath=<span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/zabbix/</span>alertscripts<br>ExternalScripts=<span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/zabbix/</span>externalscripts<br>LogSlowQueries=<span class="hljs-number">3000</span><br><br><span class="hljs-comment">#修改zabbix前端的语言php配置</span><br>[root@server ~]<span class="hljs-comment"># vim /etc/httpd/conf.d/zabbix.conf </span><br>php_value date.timezone Asia/Shanghai<br><br><span class="hljs-comment">#启动zabbix-server及httpd</span><br>[root@server ~]<span class="hljs-comment"># systemctl enable zabbix-server --now</span><br>[root@server ~]<span class="hljs-comment"># systemctl enable httpd --now</span><br><span class="hljs-comment">#防火墙放行</span><br>[root@server ~]<span class="hljs-comment"># firewall-cmd --zone=public --add-port=80/tcp --per</span><br>[root@server ~]<span class="hljs-comment"># firewall-cmd --zone=public --add-port=10051/tcp --per</span><br>[root@server ~]<span class="hljs-comment"># firewall-cmd --reload</span><br>[root@server ~]<span class="hljs-comment">#</span><br><br></code></pre></td></tr></table></figure><p>可以正常访问<a href="http://xxx.xx.xx.xx./zabbix/">http://xxx.xx.xx.xx./zabbix/</a> , 现在我们可以正式进入到zabbix-web界面进行配置了</p><p><img src="/img/zabbix/zabbix_2.png"><br><img src="/img/zabbix/zabbix_3.png"><br><img src="/img/zabbix/zabbix_4.png"><br><img src="/img/zabbix/zabbix_5.png"><br><img src="/img/zabbix/zabbix_6.png"></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">上面的安装操作将会在该路径生成配置文件<br>[root@server ~]# ls <span class="hljs-regexp">/etc/</span>zabbix<span class="hljs-regexp">/web/</span>zabbix.conf.php <br><span class="hljs-regexp">/etc/</span>zabbix<span class="hljs-regexp">/web/</span>zabbix.conf.php<br></code></pre></td></tr></table></figure><p><img src="/img/zabbix/zabbix_7.png"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit">然后配置中文，如果没有中文选项的话，需要安装一下中文包<br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># yum -y install langpacks-zh_CN</span><br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># yum -y install glibc-common</span><br></code></pre></td></tr></table></figure><p><img src="/img/zabbix/zabbix_8.png"><br><img src="/img/zabbix/zabbix_9.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">添加报警媒介<br></code></pre></td></tr></table></figure><p><img src="/img/zabbix/zabbix_10.png"></p>]]></content>
    
    
    <categories>
      
      <category>Zabbix</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zabbix概念系统（一）</title>
    <link href="/2021/03/12/zabbix/Zabbix%E6%A6%82%E5%BF%B5%E7%B3%BB%E7%BB%9F(%E4%B8%80)/"/>
    <url>/2021/03/12/zabbix/Zabbix%E6%A6%82%E5%BF%B5%E7%B3%BB%E7%BB%9F(%E4%B8%80)/</url>
    
    <content type="html"><![CDATA[<h2 id="一、zabbix研究的内容"><a href="#一、zabbix研究的内容" class="headerlink" title="一、zabbix研究的内容"></a>一、zabbix研究的内容</h2><p>1.zabbix是一个基于web界面的提供分布式系统监控以及网络监控功能的企业级开源解决方案。zabbix能监<br>控各种网络参数，保证服务器系统的安全运行，并且能够提供灵活的通知报警机制让系统管理员能快速的发现<br>问题，定位问题，解决问题</p><p>2.zabbix除了支持主动模式之外还支持被动模式。所谓的主动还是被动针对的是agent，agent向zabbix的<br>server发送数据，就表示是主动模式，agent被动的等待server来提取数据，就是被动模式</p><p>3.zabbix支持分布式的架构，可以采用zabbix proxy的方式来实现监控平台的轻松扩容，可以简单的实现<br>多数据中心多云平台监控。你想要扩容，搭建zabbix proxy即可</p><p>4.zabbix支持多种报警，短信（SMS），邮件，语音，微软的team，企业微信，钉钉</p><p>5.zabbix是免费的。是开源的，是对公众可以任意使用的。虽然zabbix是开源的免费的，但是如果运维人员<br>的水平不够可能也没办法发挥zabbix的全部功能，一般对于开源监控平台来说，如果想玩到高级的程度，必<br>须要具备开发的知识。这个知识针对中小型的公司，需要运维人员对监控平台进行维护和问题发现以及问题处<br>理，对开发人员要求动态实时的定制需要监控的内容。所以说商机就来了，有很多公司提供zabbix的技术支<br>持，zabbix社区就是这些众多提供商业支持的最大的一家公司</p><h2 id="二、zabbix的架构"><a href="#二、zabbix的架构" class="headerlink" title="二、zabbix的架构"></a>二、zabbix的架构</h2><p><img src="/img/zabbix/zabbix_1.jpg"></p><h2 id="三、zabbix的组件"><a href="#三、zabbix的组件" class="headerlink" title="三、zabbix的组件"></a>三、zabbix的组件</h2><ul><li><p>zabbix agent：部署在被监控主机上，负责收集本地数据并发往server端或proxy端</p></li><li><p>zabbix server:通过收集agent发送的数据，写入数据库（MySQL，ORACLE），在通过php+apache/nginx在web前端展</p></li><li><p>zabbix database：专用于存储所有配置信息，以及由zabbix收集的数据</p></li><li><p>zabbix web：zabbix的GUI接口，通常与server运行在同一台主机上</p></li><li><p>zabbix proxy：选组件，常用于分布式监控环境中，代理server收集部分被监控端的监控数据并同意发往server端</p></li></ul><p>Zabbix的监控流程可以简单描述为:<br><strong>数据采集–&gt;数据存储–&gt;数据分析–&gt;数据展示–&gt;监控报警</strong><br>其中：<br>数据采集：Zabbix通过SNMP、Agent、ICMP、SSH、IPMI等进行数据采集<br>数据存储：Zabbix存储在MySQL上，也可以存储在其他数据库<br>数据展示：web界面展示、(移动APP、java_php开发一个web界面也可以)<br>数据报警：邮件报警、微信报警、短信报警、报警升级机制</p><p><strong>Zabbix的监控配置流程可以简单描述为：</strong><br>告警是由一系列的流程组成，首先是触发器达到阀值，产生一个事件，接下来由Action对事件信息进行处理，其中包括两部分：<br>第一部分是发送消息，即将告警信息发送给用户。<br>第二部分是执行命令，即将事件用命令进行处理，达到对事件故障自动尝试恢复的效果。</p><p>Host groups（主机组）–&gt;Hosts（主机）–&gt;template(模板)–&gt;Applications（监控项组）–&gt;Items（监控项）–&gt;graph(图形) –&gt;screen (图形分组)–&gt;Triggers（触发器）–&gt;Event（事件）–&gt;Actions（处理动作）–&gt;Media types(告警升级|1.执行远程命令2.发送告警邮件)–&gt;User groups（用户组）–&gt;Users（用户）–&gt;Medias(告警邮件)</p><p><strong>zabbix监控环境中基本概念</strong></p><ul><li><p>主机（host）：主要监控的网络设备，可由IP或DNS名称指定；</p></li><li><p>主机组（host group）：主机的逻辑容器，可以包含主机和模板，但同一个组织内的主机和模板不能互相链接；主机组通常在给用户或用户组指派监控权限时使用</p></li><li><p>监控项（item）：一个特定监控指标的相关的数据；这些数据来自于被监控对象；item是zabbix进程数据收集的核心，相对某个监控对象，每个item都由“key”标识</p></li><li><p>触发器（trigger）：一个表达式，用于评估某监控对象的特定item内接收的数据是否在合理范围内，也就是阈值；接收的数据量大于阈值时，触发器状态将从“OK”转变为“Problem”，当数据再次恢复到合理范围，又转变为“OK”</p></li><li><p>事件（event）：触发一个值得关注的事情，比如触发器状态转变，新的agent或重新上线的agent的自动注册等</p></li><li><p>动作（action）：指对于特定事件事先定义的处理方法，如发送通知，何时执行操作</p></li><li><p>报警升级（escalation）：发送报警或者执行远程命令的自定义方案，如每隔5分钟发送一次报警，共发送5次等。</p></li><li><p>媒介（media）：发送通知的手段或者通道，如Email，Jabber或者SMS等</p></li><li><p>通知（notification）：通过选定的媒介向用户发送有关某事件的信息</p></li><li><p>远程命令（remote command）：预定义的命令，可在被监控主机处于某特定条件下时自动执行</p></li><li><p>模板（template）：用于快速定义被监控主机的预设条目集合，通常包含了item、trigger、graph、screen、application以及low-level discovery rule；模板可以直接链接到某个主机</p></li><li><p>应用（application）：一组item的集合</p></li><li><p>Web场景（web scennario）：用于检测web站点可用性的一个或多个HTTP请求</p></li><li><p>前端（frontend）：zabbix的web接口</p></li></ul><p>在实际生产使用的时候，Items、Trigger、Graph采用模板来进行监控，模板特点就是可以重复的事情一次完成，修改了模板等于修改了所有调用此模板的主机,这样可解放运维的双手.<br>Graph不是必需的，因为没有配置图形，数据获取并不影响，获取数据是Items的功能。但是对于使用ZabbixWeb界面用户来说，没有图形等于没有数据，因此重要的Items必须添加必要的图形以做可视化展示。如果想集中查看图形，可以通过screen功能。</p><h2 id="四、zabbix的主动模式和被动模式"><a href="#四、zabbix的主动模式和被动模式" class="headerlink" title="四、zabbix的主动模式和被动模式"></a>四、zabbix的主动模式和被动模式</h2><p><strong>一个监控系统运行的大概流程是这样的:</strong><br>Zabbix agent需要安装到被监控的主机上，它负责定期收集各项数据，并发送到zabbix server端，zabbix server将数据存储到数据库中，zabbix web根据数据在前端进行展现和绘图。<br><strong>这里agent收集数据分为主动和被动两种模式：</strong><br>主动：agent请求server获取主动的监控项列表，并主动将监控项内需要检测的数据提交给server/proxy<br>被动：server向agent请求获取监控项的数据，agent返回数据</p><p><strong>监控功能</strong><br>主机的性能监控、网络设备性能监控、数据库性能监控、多种警告方式、详细的报表图表绘制</p><p>监控主机zabbix有专用的agent，可以监控Linux、Windows、FreeBSD等</p><p>监控网络设备zabbix通过SNMP、ssh</p><p>可监控对象：</p><pre><code>   设备：服务器、路由器、交换机   软件：OS、网络、应用程序   主机性能指标监控   故障监控：down机、服务不可达、主机不可达</code></pre><p>在实际监控架构中，zabbix根据网络环境、监控规模等分了三种架构：server-client、server-proxy-client、master-node-client、三种。</p><ul><li><p>server-client：监控机和被监控机直接不经过任何代理，直接由zabbix server和zabbix agentd之间进行数据交互。适用于网络比较简单，设备比较少的监控环境。</p></li><li><p>server-proxy-client： 其中proxy是server、client之间沟通的一个桥梁，proxy本身没有前端，而且其本身并不存放数据，只是将agentd发来的数据暂时存放，而后再提交给server。该架构经常是和master-node-client架构做比较的架构，一般适用于跨机房、跨网络的中型网络架构的监控。</p></li><li><p>该架构是zabbix最复杂的监控架构，适用于跨网络、跨机房、设备较多的大型环境。每个node同时也是一个server端，node下面可以接proxy，也可以直接接client。Node有自己的配置文件和数据库，其要做的是将配置信息和监控数据向master同步</p></li></ul><p><strong>最后我也是用了zabbix最简单的架构server-client</strong></p>]]></content>
    
    
    <categories>
      
      <category>Zabbix</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux系统磁盘划分、物理卷、卷组、逻辑卷建立以及扩容挂载自启动</title>
    <link href="/2021/03/03/Linux/Linux_extend/"/>
    <url>/2021/03/03/Linux/Linux_extend/</url>
    
    <content type="html"><![CDATA[<h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><p><strong>1、物理卷(pvcreate):通常一个分区或者一个硬盘就可以建立一个物理卷，物理卷的最小单位是PE,一般默认是4MB。</strong></p><p><strong>2、卷组(vgcreate):用于创建LVM卷组。卷组（Volume Group）将多个物理卷组织成一个整体，屏蔽了底层物理卷细节。在卷组上创建逻辑卷时不用考虑具体的物理卷信息。</strong></p><p><strong>3、逻辑卷(lvcreate):用于创建LVM的逻辑卷。逻辑卷是创建在卷组之上的。逻辑卷对应的设备文件保存在卷组目录下，例如：在卷组”vg1000”上创建一个逻辑卷”lvol0”，则此逻辑卷对应的设备文件为”/dev/vg1000/lvol0”。</strong></p><h2 id="实验开始"><a href="#实验开始" class="headerlink" title="实验开始"></a>实验开始</h2><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@server ~]<span class="hljs-comment"># fdisk -l /dev/sdb</span><br>Disk /dev/sdb: <span class="hljs-number">20</span> GiB, <span class="hljs-number">21474836480</span> bytes, <span class="hljs-number">41943040</span> sectors<br>Units: sectors <span class="hljs-keyword">of</span> <span class="hljs-number">1</span> * <span class="hljs-number">512</span> = <span class="hljs-number">512</span> bytes<br>Sector size (logical<span class="hljs-regexp">/physical): 512 bytes /</span> <span class="hljs-number">512</span> bytes<br>I<span class="hljs-regexp">/O size (minimum/optimal): 512 bytes /</span> <span class="hljs-number">512</span> bytes<br>Disklabel type: dos<br>Disk identifier: <span class="hljs-number">0x1a726657</span><br>[root@server ~]<span class="hljs-comment"># </span><br><span class="hljs-comment">#分了两个主分区各10G</span><br>[root@server ~]<span class="hljs-comment"># fdisk /dev/sdb</span><br>Device     Boot    Start      End  Sectors Size Id Type<br>/dev/sdb1           <span class="hljs-number">2048</span> <span class="hljs-number">20973567</span> <span class="hljs-number">20971520</span>  <span class="hljs-number">10</span>G <span class="hljs-number">83</span> Linux<br>/dev/sdb2       <span class="hljs-number">20973568</span> <span class="hljs-number">41943039</span> <span class="hljs-number">20969472</span>  <span class="hljs-number">10</span>G <span class="hljs-number">83</span> Linux<br><br><span class="hljs-comment">#创建物理卷</span><br>[root@server ~]<span class="hljs-comment"># pvcreate /dev/sdb1 /dev/sdb2</span><br>WARNING: dos signature detected <span class="hljs-literal">on</span> /dev/sdb2 at offset <span class="hljs-number">510.</span> Wipe <span class="hljs-literal">it</span>? [y/n]: y<br>  Wiping dos signature <span class="hljs-literal">on</span> /dev/sdb2.<br>WARNING: atari signature detected <span class="hljs-literal">on</span> /dev/sdb2 at offset <span class="hljs-number">466.</span> Wipe <span class="hljs-literal">it</span>? [y/n]: y<br>  Wiping atari signature <span class="hljs-literal">on</span> /dev/sdb2.<br>  Physical volume <span class="hljs-string">&quot;/dev/sdb1&quot;</span> successfully created.<br>  Physical volume <span class="hljs-string">&quot;/dev/sdb2&quot;</span> successfully created.<br>[root@server ~]<span class="hljs-comment"># </span><br><span class="hljs-comment">##查看创建是否成功</span><br>[root@server ~]<span class="hljs-comment"># pvscan</span><br>  PV <span class="hljs-regexp">/dev/sda2   VG rhel_server     lvm2 [&lt;19.00 GiB /</span> <span class="hljs-number">0</span>    free]<br>  PV /dev/sdb1                      lvm2 [<span class="hljs-number">10.00</span> GiB]<br>  PV /dev/sdb2                      lvm2 [&lt;<span class="hljs-number">10.00</span> GiB]<br>  Total: <span class="hljs-number">3</span> [&lt;<span class="hljs-number">39.00</span> GiB] / <span class="hljs-keyword">in</span> use: <span class="hljs-number">1</span> [&lt;<span class="hljs-number">19.00</span> GiB] / <span class="hljs-keyword">in</span> <span class="hljs-literal">no</span> VG: <span class="hljs-number">2</span> [&lt;<span class="hljs-number">20.00</span> GiB]<br><br><span class="hljs-comment">##将物理卷添加到卷组，这里暂时只添加了/dev/sdb1的一个分区</span><br>[root@server ~]<span class="hljs-comment"># vgcreate vg1 /dev/sdb1</span><br>  Volume group <span class="hljs-string">&quot;vg1&quot;</span> successfully created<br><br><span class="hljs-comment">##pvs查看加入的情况</span><br>[root@server ~]<span class="hljs-comment"># pvs</span><br>  PV         VG          Fmt  Attr PSize   PFree  <br>  /dev/sda2  rhel_server lvm2 a--  &lt;<span class="hljs-number">19.00g</span>      <span class="hljs-number">0</span> <br>  /dev/sdb1  vg1         lvm2 a--  &lt;<span class="hljs-number">10.00g</span> &lt;<span class="hljs-number">10.00g</span><br>  /dev/sdb2              lvm2 ---  &lt;<span class="hljs-number">10.00g</span> &lt;<span class="hljs-number">10.00g</span><br><br><span class="hljs-comment">#在卷组Vg1下创建data并分配8G空间给到逻辑data</span><br>[root@server ~]<span class="hljs-comment"># lvcreate -n data -L 8G vg1</span><br>WARNING: ext4 signature detected <span class="hljs-literal">on</span> /dev/vg1/data at offset <span class="hljs-number">1080.</span> Wipe <span class="hljs-literal">it</span>? [y/n]: y<br>  Wiping ext4 signature <span class="hljs-literal">on</span> /dev/vg1/data.<br>  Logical volume <span class="hljs-string">&quot;data&quot;</span> created.<br>[root@server ~]<span class="hljs-comment"># </span><br><span class="hljs-comment">#将磁盘格式化为ext4类型</span><br>[root@server ~]<span class="hljs-comment"># mkfs.ext4 /dev/vg1/data</span><br>mke2fs <span class="hljs-number">1.44</span>.<span class="hljs-number">3</span> (<span class="hljs-number">10</span>-July-<span class="hljs-number">2018</span>)<br>Creating filesystem <span class="hljs-keyword">with</span> <span class="hljs-number">2097152</span> <span class="hljs-number">4k</span> blocks <span class="hljs-keyword">and</span> <span class="hljs-number">524288</span> inodes<br>Filesystem UUID: <span class="hljs-number">3e</span>9d17d5-f6f8-<span class="hljs-number">459e</span>-bcdc-b0a4805fffbf<br>Superblock backups stored <span class="hljs-literal">on</span> blocks: <br><span class="hljs-number">32768</span>, <span class="hljs-number">98304</span>, <span class="hljs-number">163840</span>, <span class="hljs-number">229376</span>, <span class="hljs-number">294912</span>, <span class="hljs-number">819200</span>, <span class="hljs-number">884736</span>, <span class="hljs-number">1605632</span><br><br>Allocating group tables: done                            <br>Writing inode tables: done                            <br>Creating journal (<span class="hljs-number">16384</span> blocks): done<br>Writing superblocks <span class="hljs-keyword">and</span> filesystem accounting information: done <br>[root@server ~]<span class="hljs-comment"># </span><br><br><span class="hljs-comment">##然后挂载就可以使用了</span><br>[root@server ~]<span class="hljs-comment"># mount /dev/vg1/data /root/data</span><br>[root@server ~]<span class="hljs-comment"># df -Th | grep data</span><br>/dev/mapper/vg1-data         ext4      <span class="hljs-number">7.9</span>G   <span class="hljs-number">36</span>M  <span class="hljs-number">7.4</span>G   <span class="hljs-number">1</span>% /root/data<br><br><span class="hljs-comment">##假如data空间不够用了，这时候就要开始扩容了，将/dev/sdb2加入卷组Vg1</span><br>[root@server ~]<span class="hljs-comment"># vgextend vg1 /dev/sdb2</span><br>  Volume group <span class="hljs-string">&quot;vg1&quot;</span> successfully extended<br><span class="hljs-comment">##查看剩余空间</span><br>[root@server ~]<span class="hljs-comment"># vgs</span><br>  VG          <span class="hljs-comment">#PV #LV #SN Attr   VSize   VFree </span><br>  rhel_server   <span class="hljs-number">1</span>   <span class="hljs-number">2</span>   <span class="hljs-number">0</span> wz--n- &lt;<span class="hljs-number">19.00g</span>     <span class="hljs-number">0</span> <br>  vg1           <span class="hljs-number">2</span>   <span class="hljs-number">1</span>   <span class="hljs-number">0</span> wz--n-  <span class="hljs-number">19.99g</span> <span class="hljs-number">11.99g</span><br><br><span class="hljs-comment">#在线扩容将data增加多5G的空间</span><br>[root@server ~]<span class="hljs-comment"># lvextend /dev/vg1/data -L +5G</span><br>  Size <span class="hljs-keyword">of</span> logical volume vg1/data changed <span class="hljs-keyword">from</span> <span class="hljs-number">8.00</span> GiB (<span class="hljs-number">2048</span> extents) <span class="hljs-keyword">to</span> <span class="hljs-number">13.00</span> GiB (<span class="hljs-number">3328</span> extents).<br>  Logical volume vg1/data successfully resized.<br>[root@server ~]<span class="hljs-comment"># lvs</span><br>  LV   VG          Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<br>  root rhel_server -wi-ao---- &lt;<span class="hljs-number">17.00g</span>                                                    <br>  swap rhel_server -wi-ao----   <span class="hljs-number">2.00g</span>                                                    <br>  data vg1         -wi-ao----  <span class="hljs-number">13.00g</span>   <br><br><span class="hljs-comment">#因为扩容后没有格式化所以在文件系统上查看不到</span><br>[root@server ~]<span class="hljs-comment"># df -Th | grep data</span><br>/dev/mapper/vg1-data         ext4      <span class="hljs-number">7.9</span>G   <span class="hljs-number">36</span>M  <span class="hljs-number">7.4</span>G   <span class="hljs-number">1</span>% /root/data<br><br><span class="hljs-comment">#将扩容的空间加入到data文件系统上, resize2fs :针对文件系统ext2 ext3 ext4  xfs_growfs:针对文件系统xfs </span><br><br>[root@server ~]<span class="hljs-comment"># resize2fs /dev/vg1/data</span><br>resize2fs <span class="hljs-number">1.44</span>.<span class="hljs-number">3</span> (<span class="hljs-number">10</span>-July-<span class="hljs-number">2018</span>)<br>Filesystem at /dev/vg1/data <span class="hljs-keyword">is</span> mounted <span class="hljs-literal">on</span> /root/data; <span class="hljs-literal">on</span>-line resizing required<br>old_desc_blocks = <span class="hljs-number">1</span>, new_desc_blocks = <span class="hljs-number">2</span><br>The filesystem <span class="hljs-literal">on</span> /dev/vg1/data <span class="hljs-keyword">is</span> now <span class="hljs-number">3407872</span> (<span class="hljs-number">4k</span>) blocks long.<br><br>[root@server ~]<span class="hljs-comment"># df -Th | grep data</span><br>/dev/mapper/vg1-data         ext4       <span class="hljs-number">13</span>G   <span class="hljs-number">40</span>M   <span class="hljs-number">13</span>G   <span class="hljs-number">1</span>% /root/data<br>[root@server ~]<span class="hljs-comment"># </span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kickstart</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pxe+Dhcp+Httpd+Tftp+Kickstart搭建无人值守服务器</title>
    <link href="/2021/03/03/Linux/kickstart/"/>
    <url>/2021/03/03/Linux/kickstart/</url>
    
    <content type="html"><![CDATA[<h2 id="原理和概念"><a href="#原理和概念" class="headerlink" title="原理和概念"></a>原理和概念</h2><ul><li><p> <strong>PXE</strong> ：Pxe并不是一种安装方式，而是一种引导的方式，进行 PXE 安装的必要条件是要安装的计算机中包含一个 PXE 支持的网卡（NIC），即网卡中必须要有 PXE Client。PXE （Pre-boot Execution Environment）协议使计算机可以通过网络启动，简而言之就是引导从网络中下载系统来安装。</p></li><li><p><strong>Dhcp</strong>: 用来给 客户端（将要安装系统的主机）分配IP 地址。</p></li><li><p> <strong>Httpd</strong>：超文本传输协议,这里的角色仅提供安装系统所需的软件包。</p></li><li><p> <strong>Tftp</strong>:  服务器用来存放PXE的相关文件，比如：系统引导文件；</p></li><li><p> <strong>Kickstart</strong> : KickStart是一种无人职守安装方式。KickStart的工作原理是通过记录典型的安装过程中所需人工干预填写的各种参数，并生成一个名为 ks.cfg的文件；在其后的安装过程中（不只局限于生成KickStart安装文件的机器）当出现要求填写参数的情况时，安装程序会首先去查找 KickStart生成的文件，当找到合适的参数时，就采用找到的参数，当没有找到合适的参数时，才需要安装者手工干预。这样，如果KickStart文件涵盖了安装过程中出现的所有需要填写的参数时，安装者完全可以只告诉安装程序从何处取ks.cfg文件，然后去忙自己的事情。等安装完毕，安装程序会根据ks.cfg中设置的重启选项来重启系统，并结束安装。<br>设置BIOS引导顺序为：  硬盘，网络<br><img src="https://upload-images.jianshu.io/upload_images/9650472-74035760cf8318db.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="pxe.jpg"></p></li></ul><h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><p><strong>实验环境</strong>：Vmware Workstation 15<br><strong>系统平台</strong>：Centos7 （界面版本）<br><strong>网络模式</strong>：仅主机模式（Vmnet10网卡）</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-comment">#关闭防火墙</span><br>[root@server yum.repos.d]<span class="hljs-comment"># systemctl stop firewalld </span><br><span class="hljs-comment">#临时关闭selinux</span><br>[root@server yum.repos.d]<span class="hljs-comment"># setenforce 0</span><br><span class="hljs-comment">#搭建本地源仓库安装需要的软件</span><br>[root@server yum.repos.d]<span class="hljs-comment"># mount /dev/sr0 /home/lemonchen/iso</span><br>[root@server yum.repos.d]<span class="hljs-comment"># vim /etc/yum.repos.d/CentOS-Base.repo</span><br>[<span class="hljs-keyword">local</span>]<br>name=<span class="hljs-keyword">local</span><br>baseurl=file:<span class="hljs-regexp">//</span><span class="hljs-regexp">/home/l</span>emonchen/iso<br>enable=<span class="hljs-number">1</span><br>gpgcheck=<span class="hljs-number">1</span><br>gpgkey=file:<span class="hljs-regexp">//</span><span class="hljs-regexp">/etc/p</span>ki/rpm-gpg/RPM-GPG-KEY-CentOS-<span class="hljs-number">7</span><br><span class="hljs-comment">#增加一块网卡并配置</span><br>nmcli con add con-name ens37 type ethernet ifname ens37 ipv4.addresses <span class="hljs-number">10.1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>/<span class="hljs-number">24</span> ipv4.method manual<br>Connection <span class="hljs-string">&#x27;ens37&#x27;</span> (<span class="hljs-number">28</span>b0b6a1-<span class="hljs-number">0377</span>-<span class="hljs-number">4</span>e4b-<span class="hljs-number">87</span>f6-ef4c6b2b6da<span class="hljs-number">0</span>) successfully added.successfully added.<br><span class="hljs-comment">#启用该网卡</span><br>[root@localhost ~]<span class="hljs-comment"># nmcli con up ens37</span><br>Connection successfully activated (D-Bus active path: <span class="hljs-regexp">/org/</span>freedesktop/NetworkManager/ActiveConnection/<span class="hljs-number">7</span>)<br><span class="hljs-comment">#查看是否网卡连接成功</span><br>[root@localhost ~]<span class="hljs-comment"># nmcli device status</span><br>DEVICE  TYPE      STATE      CONNECTION <br>ens33   ethernet  connected  ens33      <br>ens37   ethernet  connected  ens37      <br>lo      loopback  unmanaged  --<br></code></pre></td></tr></table></figure><p>1、 <strong>配置Httpd服务器</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta">#httpd服务器搭建 默认端口80</span><br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># yum -y install httpd</span><br><span class="hljs-meta">#httpd的主配置文件是</span><br>/etc/httpd/conf/httpd.conf<br><span class="hljs-meta">#启动httpd服务</span><br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># systemctl start httpd</span><br><span class="hljs-meta">#设置开机自启动</span><br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># systemctl enable httpd</span><br><span class="hljs-meta">#在该目录下创建install_iso(存放系统文件)ks(存放后续kickstart配置文件)</span><br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># mkdir /var/www/html/&#123;install_iso,ks&#125;</span><br><span class="hljs-meta">#挂载系统文件到install_iso下</span><br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># mount /dev/sr0 /var/www/html/install_iso/</span><br><span class="hljs-meta">#添加开机自动挂载</span><br>[root<span class="hljs-symbol">@server</span> ~]<span class="hljs-meta"># echo <span class="hljs-string">&#x27;/dev/sr0 /var/www/html/install_iso&#x27;</span> &gt;&gt; /etc/fstab</span><br></code></pre></td></tr></table></figure><p>2、 <strong>配置TFTP服务器</strong></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#TfTP服务器搭建 默认端口<span class="hljs-number">69</span><br>[root@server ~]# yum -y install tftp-server xinetd<br>#启动tftp服务<br>[root@server ~]# systemctl enable tftp --now<br>#安装syslinux<br>[root@server ~]# yum -y install syslinux<br>#拷贝syslinux文件啊，将这个文件放入到<span class="hljs-regexp">/var/</span>lib/tftpboot下<br>#说明：syslinux是一个功能强大的引导加载程序，而且兼容各种介质<br>[root@server ~]# cp -rf <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/syslinux/</span>* <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span><br>#拷贝镜像下的vmlinuz initrd.img到tftp下<br>[root@server ~]# cp <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/i</span>nstall_iso<span class="hljs-regexp">/isolinux/</span>vmlinuz <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/i</span>nstall_iso<span class="hljs-regexp">/isolinux/i</span>nitrd.img <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span><br>#创建一个文件夹<br>[root@localhost tftpboot]# mkdir <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span>pxelinux.cfg<br>#拷贝引导配置文件到tftp目录下并修改<br>[root@server ~]# cp <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/i</span>nstall_iso<span class="hljs-regexp">/isolinux/i</span>solinux.cfg <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/tftpboot/</span>pxelinux.cfg/<span class="hljs-keyword">default</span><br></code></pre></td></tr></table></figure><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">#<span class="hljs-keyword">default</span><br>[root@localhost tftpboot]# cat /<span class="hljs-keyword">var</span>/lib/tftpboot/pxelinux.cfg/<span class="hljs-keyword">default</span> <br><span class="hljs-keyword">default</span> menu.c32<br>label lemonchenpxe<br>kernel vmlinuz<br>append initrd=initrd.img <span class="hljs-function"><span class="hljs-keyword">method</span>=<span class="hljs-title">http</span>:</span><span class="hljs-comment">//10.1.0.1/install_iso #httpd下的系统文件路径</span><br></code></pre></td></tr></table></figure><p>3、 <strong>配置DHCP服务器</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-comment">#安装dhcp服务</span><br>[root<span class="hljs-variable">@server</span> cache]<span class="hljs-comment"># yum -y install dhcp</span><br><span class="hljs-comment">#copy模板到dhcp配置目录下</span><br>[root<span class="hljs-variable">@server</span> ~]<span class="hljs-comment"># cp /usr/share/doc/dhcp-4.2.5/dhcpd.conf.example /etc/dhcp/dhcpd.conf</span><br>[root<span class="hljs-variable">@localhost</span> tftpboot]<span class="hljs-comment"># cat /etc/dhcp/dhcpd.conf </span><br><span class="hljs-comment"># dhcpd.conf</span><br><span class="hljs-comment"># # A slightly different configuration for an internal subnet.</span><br><span class="hljs-comment">#dhcp服务器告诉dhcp客户端，如果你是pxe引导，那么tftp服务器的地址</span><br><span class="hljs-comment">#是10.1.0.1，你可以到tftp服务器上的根⽬录上下载pxelinux.0</span><br>subnet <span class="hljs-number">10.1</span>.0.0 netmask <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span> &#123; <span class="hljs-comment">#ip子网及子网掩码</span><br>  range <span class="hljs-number">10.1</span>.0.<span class="hljs-number">100</span> <span class="hljs-number">10.1</span>.0.<span class="hljs-number">200</span>; <span class="hljs-comment">#网络段</span><br>  <span class="hljs-keyword">next</span>-server <span class="hljs-number">10.1</span>.0.<span class="hljs-number">1</span>; <span class="hljs-comment">#指向服务器</span><br>  filename <span class="hljs-string">&quot;pxelinux.0&quot;</span>; <span class="hljs-comment">#指向安装文件</span><br>&#125;<br></code></pre></td></tr></table></figure><p>4、 <strong>Kickstart配置自动化安装</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-meta">#就是自动化的一个配置</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># ls</span><br>anaconda-ks.cfg<br><span class="hljs-meta">#拷贝一份配置到httpd目录下</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cp anaconda-ks.cfg /var/www/html/ks/lemonchen-ks.cfg</span><br></code></pre></td></tr></table></figure><p>kickstart配置</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[root@localhost ks]# cat anaconda-ks.cfg <br><span class="hljs-comment">#version=DEVEL</span><br><span class="hljs-comment"># System authorization information(系统授权信息)</span><br>auth --enableshadow <span class="hljs-attribute">--passalgo</span>=sha512<br><span class="hljs-comment"># Use CDROM installation media(使用光盘安装介质)</span><br><span class="hljs-comment">#cdrom</span><br>url --url = <span class="hljs-string">&quot;http://10.1.0.1/install_iso&quot;</span> #下载安装路径<br><span class="hljs-comment"># Use graphical install(使用图形化安装)</span><br>graphical<br><span class="hljs-comment"># Run the Setup Agent on first boot(在第一次引导时运行安装代理)</span><br>firstboot --enable<br>ignoredisk <span class="hljs-attribute">--only-use</span>=sda<br><span class="hljs-comment"># Keyboard layouts(键盘布局)</span><br>keyboard <span class="hljs-attribute">--vckeymap</span>=us <span class="hljs-attribute">--xlayouts</span>=<span class="hljs-string">&#x27;us&#x27;</span><br><span class="hljs-comment"># System language(系统语言)</span><br>lang en_US.UTF-8<br><br><span class="hljs-comment"># Network information(网络信息)</span><br>network  <span class="hljs-attribute">--bootproto</span>=dhcp <span class="hljs-attribute">--device</span>=ens33 <span class="hljs-attribute">--onboot</span>=off <span class="hljs-attribute">--ipv6</span>=auto --no-activate<br>network  <span class="hljs-attribute">--hostname</span>=localhost.localdomain<br><br><span class="hljs-comment"># Root password(根密码)</span><br>rootpw --iscrypted <span class="hljs-variable">$1</span><span class="hljs-variable">$MWC7lQya</span><span class="hljs-variable">$o</span>/114lD9L58dVYPiJvNoM0<br><span class="hljs-comment"># System services(系统服务)</span><br>services <span class="hljs-attribute">--enabled</span>=<span class="hljs-string">&quot;chronyd&quot;</span><br><span class="hljs-comment"># System timezone(系统时区)</span><br>timezone Asia/Shanghai <br>user <span class="hljs-attribute">--groups</span>=wheel <span class="hljs-attribute">--name</span>=lemonchen <span class="hljs-attribute">--password</span>=<span class="hljs-variable">$1</span><span class="hljs-variable">$MWC7lQya</span><span class="hljs-variable">$o</span>/114lD9L58dVYPiJvNoM0 --iscrypted <span class="hljs-attribute">--gecos</span>=<span class="hljs-string">&quot;lemonchen&quot;</span><br><span class="hljs-comment"># System bootloader configuration(系统引导装载程序配置)</span><br>bootloader <span class="hljs-attribute">--append</span>=<span class="hljs-string">&quot; crashkernel=auto&quot;</span> <span class="hljs-attribute">--location</span>=mbr <span class="hljs-attribute">--boot-drive</span>=sda<br>autopart <span class="hljs-attribute">--type</span>=lvm<br><span class="hljs-comment"># Partition clearing information(分区结算信息)</span><br>clearpart --none --initlabel<br><span class="hljs-comment">#最小化安装 </span><br>%packages<br>@^minimal<br>@core<br>chrony<br>kexec-tools<br><br>%end<br><span class="hljs-comment">#安装完成后自动重启。</span><br>reboot<br><br>%addon com_redhat_kdump --<span class="hljs-builtin-name">enable</span> <span class="hljs-attribute">--reserve-mb</span>=<span class="hljs-string">&#x27;auto&#x27;</span><br><br>%end<br><br>%anaconda<br>pwpolicy root <span class="hljs-attribute">--minlen</span>=6 <span class="hljs-attribute">--minquality</span>=1 --notstrict --nochanges --notempty<br>pwpolicy<span class="hljs-built_in"> user </span><span class="hljs-attribute">--minlen</span>=6 <span class="hljs-attribute">--minquality</span>=1 --notstrict --nochanges --emptyok<br>pwpolicy luks <span class="hljs-attribute">--minlen</span>=6 <span class="hljs-attribute">--minquality</span>=1 --notstrict --nochanges --notempty<br>%end<br>[root@localhost ks]# <br></code></pre></td></tr></table></figure><p>#default修改后</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">[root@localhost tftpboot]# cat /<span class="hljs-keyword">var</span>/lib/tftpboot/pxelinux.cfg/<span class="hljs-keyword">default</span> <br><span class="hljs-keyword">default</span> menu.c32<br>timeout <span class="hljs-number">10</span><br>label lemonchenpxe<br>kernel vmlinuz<br>append initrd=initrd.img <span class="hljs-function"><span class="hljs-keyword">method</span>=<span class="hljs-title">http</span>:</span><span class="hljs-comment">//10.1.0.1/install_iso ks=http://10.1.0.1/ks/lemonchen-ks.cfg#httpd下的系统文件路径</span><br></code></pre></td></tr></table></figure><ul><li>如果打开访问不了，需要增加权限<br><img src="https://upload-images.jianshu.io/upload_images/9650472-433e9ccef29fea37.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_16024146907930.png"><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[root@localhost ks]# chmod o+r <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>ks/lemonchen-ks.cfg<br></code></pre></td></tr></table></figure>5、 <strong>基本就完成了，后续的更精细如何配置需要好好研究了</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-e47dc0679f1ec7b2.gif?imageMogr2/auto-orient/strip" alt="auto_install.gif"></li></ul>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kickstart</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WSUS部署 Windows 10 更新</title>
    <link href="/2021/03/03/Windows/wsus_update_win10/"/>
    <url>/2021/03/03/Windows/wsus_update_win10/</url>
    
    <content type="html"><![CDATA[<p>WSUS概述<br>为了让用户的windows系统与其他microsoft产品能够更安全，更稳定，因此microsoft会不定期在网站上推出最新的更新程序供用户下载与安装，而用户可以通过以下方式来取得这些程序：</p><ul><li><strong>手动连接microsoft update网站</strong></li><li> <strong>通过windows系统的自动更新功能</strong></li></ul><p>然而以上两种方式对企业内部来说，都可能会有以下缺点。</p><ul><li><strong>影响网络效率：</strong>如果企业内部每台计算机都自行上网更新，将会增加对外网络的负担。</li><li><strong>与现有软件相互干扰：</strong>如果企业内部使用的软件与更新程序发生冲突，则用户自行下载与安装更新程序可能会影响该软件或更新程序的正常运行。<br>WSUS是一个可以解决上述问题的产品，企业内部可以通过WSUS服务器集中从Microsoft update网站下载更新程序，并且在完成这些更新程序的测试工作，确定对企业内部计算机没有不良影响后，在通过网管审批程序，将程序部署到客户机上。</li></ul><p><strong>实验环境：</strong><br>1.hyper-v下的虚拟机进行<br>2.DC域控制器一台<br>3.WSUS补丁服务器一台<br>4.win10客户端一台</p><p><strong>实验目的:</strong><br>1.WSUS获取Microsoft 更新<br>2.WSUS下发更新到客户端<br>3.客户端更新成功</p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-0e2420e45bb0a553.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="拓步.jpg"></p><p><strong>1、</strong> WSUS服务器角色的安装，安装的整个过程还是比较简单的，只需要一直下一步下一步即可，使用作为本地 Administrators 组成员的帐户登录到你计划安装 WSUS 服务器角色的服务器。</p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-1bc1745001f8837a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-72f0223bd8f81e21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><ul><li>选择数据库。使用内置数据库，如果要使用SQL数据库，勾选数据库</li><li>WID connectivity: wsus需要数据库的支持，使用内置数据库。</li><li>WSUS服务：包含了更新服务、web服务、服务器同步数据等wsus的角色</li><li>SQL Server：使wsus连接SQL server数据，适合大规模部署或高可靠性</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-99e77cca06d7afd5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-5aafe22f4658944f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-a9987cf325b2fa04.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-03b8cce70b6e3ede.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-b76807eb2ba163e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p><p><strong>2、</strong> WSUS服务器角色之后，第一次使用WSUS的时候会进入WSUS的配置向导，对WSUS做一个基本的设置。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-b5823714fdb8415e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-6867638b7227ff33.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-4331f7d5c6c8b6ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-309f71eb6f4fe049.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><p>在<strong>“选择上游服务器”</strong>页上，你可选择将更新与 Microsoft 更新或其他 WSUS 服务器同步。</p><ul><li><p>如果你选择从其他 WSUS 服务器同步，请指定服务器名称以及该服务器与上游服务器通信时所在的端口。</p></li><li><p><strong>若要使用 SSL，请选中“同步更新信息时使用 SSL”复选框。</strong></p></li><li><p><strong>如果这是副本服务器，请选择“这是上游服务器的副本”复选框</strong>。</p></li></ul><p>因为我这里是第一个wsus服务器，如果你是二级wsus，这里就需要填第二个选项。</p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-63640450f465fdb3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><p><strong>在“指定代理服务器”页上，选中“同步时使用代理服务器”复选框，然后在对应的框中键入代理服务器名称和端口号（默认是端口80）。</strong></p><p><strong>如果你确定 WSUS 需要代理服务器才能访问 Internet，则必须完成上一步骤。</strong></p><p><strong>如果你希望通过使用特定用户凭据来连接代理服务器，请选择“使用用户凭据连接代理服务器”复选框，然后在对应的框中键入用户名称、域和用户密码。如果你希望启用已连接代理服务器的用户的基本身份验证，请选择“允许基本身份验证（以明文形式发送密码）”对话框。</strong></p><p>这里我就默认下一步了</p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-410fc852ac062d06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p><p>这里要求必须有<strong>internet</strong>链接。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-3e4b88e4b2171080.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c92860386e2fb539.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-2151425f263bfa33.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-3eb125cc37b37484.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p><p><strong>选择手动或自动同步。选择自动同步，需要设置第一次同步的时间与每天同步的次数。</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-332ea4853f75a520.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-a69c7da5897dc114.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="12.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-d8f8cb039847b5ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="13.png"></p><p><strong>WSUS 管理控制台</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-976bb581e7945bbd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="14.png"></p><h1 id="设置客户端的自动更新"><a href="#设置客户端的自动更新" class="headerlink" title="设置客户端的自动更新"></a>设置客户端的自动更新</h1><p>我们要让客户端计算机能够通过WSUS服务器下载更新程序，而这个设置可以通过以下两种方法来完成。</p><ul><li><p>组策略:在AD域环境下，可以通过组策略进行设置。</p></li><li><p>本地计算机策略：如果没有AD域环境，或客户端计算机未加入域，则可以通过本地计算机策略进行设置。</p></li></ul><p>我们利用组策略来进行说明。在域中创建一个GPO，WSUS策略，然后通过这个GPO来设置域内的所有客户端计算机的自动更新配置。</p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-b9dde4416b520581.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p><p>######在组策略管理编辑器中，依次转到“计算机配置”\“策略”\“管理模板”\“Windows 组件”\“Windows 更新”</p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-0fc38b97fe52c90e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><ul><li><strong>通知下载并通知安装：</strong>在下载更新程序前会通知已登录的系统管理员，由他自行决定是否现在下载；下载完成后和准备安装前也会通知系统管理员，然后由他自行决定是否现在安装。</li><li><strong>自动下载并通知安装：</strong>自动下载更新程序，下载完成后和准备安装前会通知已登录的系统管理员，然后由他自行决定是否现在安装。</li><li><strong>自动下载并计划安装：</strong>自动下载更新程序，并且会在指定的时间自动安装。需要指定安装时间。</li><li><strong>允许本地管理员选择设置：</strong>此选项让在客户端的本地管理员可以通过控制面板自行选择更新方式。</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-545478c2f3ac8097.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9391a042bc691f49.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><p>在 “选项” 下，在 “设置用于检测更新和设置 intranet 统计信息的 intranet 更新服务” 服务器选项中，键入，然后 <a href="http://Your_WSUS_Server_FQDN:PortNumber">http://Your_WSUS_Server_FQDN:PortNumber</a> 选择 “确定”。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">192.168.137.98:8530</span> #这是我WSUS服务器的ip地址，这里需要填自己wsus服务器地址。<br><span class="hljs-attribute">WSUS</span> 的默认 HTTP 端口是 <span class="hljs-number">8530</span>，安全套接字层上的默认 HTTP (HTTPS) 端口是 <span class="hljs-number">8531</span>。 (其他选项为<span class="hljs-number">80</span>和 <span class="hljs-number">443</span>;不支持任何其他端口。 )<br></code></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9650472-a1a6c6c13fc13662.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><ul><li>可以设置“自动更新检测的频率”，默认是22小时，我们可以根据实际的需要来调整间隔。如图。</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-ac7442514dbb79e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-718f1e1708c1f6b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p><ul><li>可以启用“对于已登录用户的计算机，计划的自动更新安装不执行重新启动”，这样的话，当计算机存在已登录的用户的时候，装完更新是否重启取决于用户的行为，计算机不会强制重启， </li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-95ed297e5b7a198f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-b796283cae2423f1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p><ul><li>对于某些不会中断windows服务，也不会需要重启服务器才生效的更新，我们可以配置启用“允许自动更新立即安装”。</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9d3f864b593018b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-94a4ab76271549bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></p><p>设置完成后，必须等域内的客户端应用这个策略才能有效，而客户端计算机默认每隔90-120分钟应用一次。到客户端计算机上执行<strong>gpupdate/force</strong>命令。</p><p>应用完成后，还必须等客户机与wsus服务器接触后，在wsus管理控制台才能看到这些客户机。不过需要等待20分钟才会主动联系WSUS服务器。在客户机上执行<strong>wuauclt/detectnow</strong> 命令。</p><h1 id="配置自动审批规则"><a href="#配置自动审批规则" class="headerlink" title="配置自动审批规则"></a>配置自动审批规则</h1><ul><li>可以设置当WSUS服务器与Windows Update同步时，自动审批下载的更新程序。例如，如果希望所有下载的安全更新与重要更新都能够自动审批给所有计算机:单击选项中的自动审批，在前景图中勾选默认的自动审批规则。如果还要将此规则应用到已经同步的更新程序，请单击允许规则。</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-3104c95153edd771.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-b7f8c2867fa5bf1d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-3817d2b3be8bdf47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-36dea5d3d6336538.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-6b4c0111f85332e5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-6105f6aa29b89c1a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9bcf456739578ec0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p><h1 id="手动批准并部署功能更新"><a href="#手动批准并部署功能更新" class="headerlink" title="手动批准并部署功能更新"></a>手动批准并部署功能更新</h1><p><img src="https://upload-images.jianshu.io/upload_images/9650472-150bbe452c0a4dd0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-2f54227fdee98498.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-26433d2d62b44f27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-68b7a2a147a853fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><pre><code>参考 [https://blog.51cto.com/search/user?uid=639838&amp;q=WSUS] [https://docs.microsoft.com/zh-cn/windows/deployment/update/waas-manage-updates-wsus#%E7%AE%A1%E7%90%86-windows-10-%E6%9B%B4%E6%96%B0%E7%9A%84%E6%AD%A5%E9%AA%A4steps-to-manage-updates-for-windows-10](https://docs.microsoft.com/zh-cn/windows/deployment/update/waas-manage-updates-wsus#%E7%AE%A1%E7%90%86-windows-10-%E6%9B%B4%E6%96%B0%E7%9A%84%E6%AD%A5%E9%AA%A4steps-to-manage-updates-for-windows-10)</code></pre>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WinServer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Powershell批量创建AD用户</title>
    <link href="/2021/03/03/Powershell/powershell_add_user/"/>
    <url>/2021/03/03/Powershell/powershell_add_user/</url>
    
    <content type="html"><![CDATA[<p><strong>查看Powershell版本</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-78582f4b3d5563e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p><ul><li>准备好相关域用户信息，一般都是Excel表，以AdUserData.csv格式保存，再以文档模式打开，编码设置<strong>UTF-8</strong>保存覆盖当前文件。</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-7a674dd0e9f9cd39.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-a2592079e3018cbd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-90e106183dce459e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15860831608682.png"></p><ul><li>此时无用户<br><img src="https://upload-images.jianshu.io/upload_images/9650472-d98286ee79eceebe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Import-Csv</span> <span class="hljs-string">&#x27;C:\Users\administrator\Desktop\AdUserData.csv&#x27;</span>| <br><span class="hljs-built_in">ForEach-Object</span>&#123;<span class="hljs-built_in">New-ADUser</span> <span class="hljs-literal">-SamAccountName</span> <span class="hljs-variable">$_</span>.SamAccountName <span class="hljs-literal">-Surname</span> <span class="hljs-variable">$_</span>.Surname <span class="hljs-literal">-GivenName</span> <span class="hljs-variable">$_</span>.GivenName <span class="hljs-literal">-Name</span> `<br><span class="hljs-variable">$_</span>.Name <span class="hljs-literal">-UserPrincipalName</span> <span class="hljs-variable">$_</span>.UserPrincipalName <span class="hljs-literal">-DisplayName</span> `<br><span class="hljs-variable">$_</span>.Name <span class="hljs-literal">-Description</span> <span class="hljs-variable">$_</span>.Name <span class="hljs-literal">-Path</span> <span class="hljs-variable">$_</span>.Path <span class="hljs-literal">-AccountPassword</span>(<span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-variable">$_</span>.AccountPassword <span class="hljs-literal">-Force</span>) <span class="hljs-literal">-Enabled</span> <span class="hljs-number">1</span> <span class="hljs-literal">-ChangePasswordAtLogon</span> <span class="hljs-number">1</span> &#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9650472-435d00f80bb71b86.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-1b7868cb6433574c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p><p><strong>New-ADUser -SamAccountName</strong>: 新建域用户</p><p><strong>$_.SamAccountName</strong>: 匹配表格第一列</p><p><strong>-Enabled 1</strong> :启用域用户</p><p><strong>-ChangePasswordAtLogon 1</strong> ：用户下次登陆时必须更改密码</p>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>powershell</tag>
      
      <tag>WinServer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows自动化装机部署（六）自动化部署配置</title>
    <link href="/2021/03/03/MDT/windows_autoinstall_06/"/>
    <url>/2021/03/03/MDT/windows_autoinstall_06/</url>
    
    <content type="html"><![CDATA[<p><strong>现在我们就可以通过MDT进行部署了，在开始部署操作系统之前，我们需要对Windows PE启动引导进行简单自动化配置，从而方便后续操作系统部署的顺利进行，需要补充的是：在未集成SQL之前，这里的自定制设置是整个自动化部署过程中最重要的环节。接下来就为大家带来今日的自动化部署配置、客户端部署过程中信息系统日志的远程存放（Logs日志的远程存放是为了方便大家在分发失败的时候更好的排错）、控制台的更新内容。</strong></p><ul><li>配置启动镜像，选择“MDT Deployment Share”右键属性：<br><img src="https://upload-images.jianshu.io/upload_images/9650472-0418781644a6abe8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></li></ul><ul><li><p>Network(UNC) path网络共享存放路径，及Local path本地存放路径位置<br><img src="https://upload-images.jianshu.io/upload_images/9650472-ae21960db190f321.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p></li><li><p>设置 Rules 参数（自动化部署参数）<br><img src="https://upload-images.jianshu.io/upload_images/9650472-8bab89ede8a202cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-d19c6a3d5cf8da46.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15882408357760.png"></p><ul><li>点击Windows PE 出现了报错是因为没有预安装PE负载项 <a href="%5Bhttps://docs.microsoft.com/zh-cn/windows-hardware/get-started/adk-install%5D(https://docs.microsoft.com/zh-cn/windows-hardware/get-started/adk-install)">下载链接</a><br><img src="https://upload-images.jianshu.io/upload_images/9650472-50f54e9457e802c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-71b5e0e639c4a3b5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15882315885634.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-df2f203ee80e63ea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-18fd083477ab6896.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-32f283bdd0c70747.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-6496337bc142e22c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-8564818bd093e72f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p><ul><li>勾选掉“Generate a lite Touch bootable ISO image”，即不创建ISO镜像<br><img src="https://upload-images.jianshu.io/upload_images/9650472-4e36d8fd5917f439.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-a583648b8e944931.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><ul><li><p>为了防止有中文识别乱码问题，建议奖香港台湾两地语言包一起勾选<br><img src="https://upload-images.jianshu.io/upload_images/9650472-8c54b159bd1eb09f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p></li><li><p>相关驱动及补丁包的默认调用设置<br><img src="https://upload-images.jianshu.io/upload_images/9650472-38eecdfc31043a16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p></li></ul><ul><li>我们需要在相应服务器上设置一个共享文件夹，everyone有可读可写权限，以方便客户端日志信息的远程写入。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-79d4ee6aff70332c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-cb91287ce3b72a21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-db5c6681701645a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p><ul><li> 右键MDT Deployment Share ，选择Update Deployment Share进行更新 (每次更改操作后都需要更新)<br><img src="https://upload-images.jianshu.io/upload_images/9650472-98fd9616426a47e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-ab19ad0bb65ea623.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-2a3cb1ecfd1aa9bd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p><ul><li> 启动映像生成完成，会在对应Deploymentshare下的Boot目录下生成相应的启动WIM映像；<br><img src="https://upload-images.jianshu.io/upload_images/9650472-86c2c80cc5ada111.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></li></ul><ul><li> rules 自动化参数详解<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs awk">Rules 参数设置注解：<br>[Settings]<br>Priority=Default<br>Properties=MyCustomProperty<br>[Default]<br>OSInstall=YES <span class="hljs-regexp">//</span>是否允许部署操作系统到目标计算机<br>SkipBDDWelcome= NO <span class="hljs-regexp">//</span>是否跳过欢迎界面<br>SkipCapture= NO <span class="hljs-regexp">//</span>是否跳过镜像捕获<br>SkipDeploymentType= NO <span class="hljs-regexp">//</span>是否跳过选择部署类型<br>DeploymentType=NEWCOMPUTER<br>SkipAdminPassword= NO <span class="hljs-regexp">//</span>是否跳过设置本地管理员密码<br>adminpassword=<br>SkipAppsOnUpgrade=NO <span class="hljs-regexp">//</span>是否跳过应用程序安装向导页<br>SkipComputerName=NO <span class="hljs-regexp">//</span>是否跳过设置计算机名<br>SkipProductKey= NO <span class="hljs-regexp">//</span>是否跳过输入产品密钥<br>SkipDomainMembership=NO <span class="hljs-regexp">//</span>是否跳过加域或工作组<br>SkipComputerBackup= NO <span class="hljs-regexp">//</span>是否跳过计算机备份<br>SkipBitLocker=YES <span class="hljs-regexp">//</span>是否跳过BitLocker配置<br>SKipTaskSequence=NO <span class="hljs-regexp">//</span>是否跳过任务序列（可自定义）<br>SkipFinalSummary= NO <span class="hljs-regexp">//</span>是否跳过系统部署完成后的最后总结<br>SkipTimeZone= NO <span class="hljs-regexp">//</span>是否跳过时区和语言设置<br>TimeZoneName=China Standard Time <span class="hljs-regexp">//</span>时区<br>KeyboardLocale=zh-cn <span class="hljs-regexp">//</span>键盘区域<br>UserLocale=zh-cn <span class="hljs-regexp">//</span>用户区域<br>UILanguage=zh-cn <span class="hljs-regexp">//</span>语言<br>SkipLocaleSelection= NO <span class="hljs-regexp">//</span>是否跳过本地选择<br>SkipUserData= NO <span class="hljs-regexp">//</span>是否跳过用户数据配置<br>SkipSummary= NO <span class="hljs-regexp">//</span>是否跳过配置摘要确认<br>SLShare=\********\logs <span class="hljs-regexp">//</span>可指定部署日志存放位置，以方便日常排错<br>Bootstrap 参数设置注解：<br>[Settings]<br>Priority=Default<br>[Default]<br>DeployRoot=\<span class="hljs-number">10.0</span>.<span class="hljs-number">0.2</span>\DeploymentShare$ <span class="hljs-regexp">//</span>共享目录<br>UserID=administrator <span class="hljs-regexp">//</span>启动管理账户设置<br>UserDomain=***** <span class="hljs-regexp">//</span>启动账户所属的域<br>UserPassword=***** <span class="hljs-regexp">//</span>账户对应密码<br>KeyboardLocale=zh-cn <span class="hljs-regexp">//</span>键盘语言设置<br>SkipBDDWelcome=YES <span class="hljs-regexp">//</span>是否跳过欢迎界面<br><br>作者：强出头<br>链接：https:<span class="hljs-regexp">//</span>www.jianshu.com<span class="hljs-regexp">/p/</span><span class="hljs-number">60</span>cc9cfc3c17<br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。<br></code></pre></td></tr></table></figure></li></ul><ul><li> 下面是我的rules规则，可以参考下<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Settings]</span><br><span class="hljs-attr">Priority</span>=Default<br><span class="hljs-attr">Properties</span>=MyCustomProperty<br><br><span class="hljs-section">[Default]</span><br><span class="hljs-attr">OSInstall</span>=Y<br><span class="hljs-attr">SkipCapture</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipAdminPassword</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipProductKey</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipComputerBackup</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipBitLocker</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipProductKey</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipComputerBackup</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipBitLocker</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipUserData</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipTimeZone</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipLocalSelection</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">TimeZoneName</span>=China Standard Time<br><span class="hljs-attr">KeyboardLocale</span>=zh-cn<br><span class="hljs-attr">UserLocale</span>=zh-cn<br><span class="hljs-attr">UILanguage</span>=zh-cn<br><span class="hljs-attr">SkipAppsOnUpgrade</span>=<span class="hljs-literal">NO</span><br><span class="hljs-attr">SkipApplications</span>=N0<br><span class="hljs-attr">Applications1</span>=&#123;cfa9a4cf-<span class="hljs-number">167</span>a-<span class="hljs-number">4380</span>-<span class="hljs-number">9</span>c3f-dc657377de2c&#125;<br><span class="hljs-attr">Applications2</span>=&#123;f158bf0d-facd-<span class="hljs-number">49</span>b9-<span class="hljs-number">9761</span>-<span class="hljs-number">6</span>d1207ec18b7&#125;<br><span class="hljs-attr">Applications3</span>=&#123;e5d86726-d376-<span class="hljs-number">43</span>b1-<span class="hljs-number">9484</span>-a7d2ac9af3a5&#125;<br><span class="hljs-attr">Applications4</span>=&#123;<span class="hljs-number">5490</span>fcee-<span class="hljs-number">5573</span>-<span class="hljs-number">4</span>ea1-be11-<span class="hljs-number">152</span>e3fa7137a&#125;<br><span class="hljs-attr">Applications5</span>=&#123;<span class="hljs-number">418507</span>b4-a13a-<span class="hljs-number">4119</span>-aab8-<span class="hljs-number">4</span>d413b9a8eea&#125;<br><span class="hljs-attr">Applications6</span>=&#123;d8879eda-<span class="hljs-number">9</span>a6e-<span class="hljs-number">4608</span>-ad6b-<span class="hljs-number">45</span>dd5cc0f203&#125;<br><span class="hljs-attr">Applications7</span>=&#123;<span class="hljs-number">4</span>c5e5b9d-a634-<span class="hljs-number">44</span>a2-af91-<span class="hljs-number">2092</span>da80c029&#125;<br><span class="hljs-attr">Applications8</span>=&#123;<span class="hljs-number">2</span>fa352d7-b77f-<span class="hljs-number">44</span>f1-bfc5-<span class="hljs-number">813</span>bc9b8b083&#125;<br><span class="hljs-attr">Applications9</span>=&#123;c58a59db-<span class="hljs-number">1337</span>-<span class="hljs-number">4</span>b94-<span class="hljs-number">8</span>d86-<span class="hljs-number">9</span>ab61d1d0f8e&#125;<br><span class="hljs-attr">Applications10</span>=&#123;a07efd26-fda3-<span class="hljs-number">4410</span>-<span class="hljs-number">8462</span>-<span class="hljs-number">74</span>ba1437d466&#125;<br><span class="hljs-attr">Applications11</span>=&#123;<span class="hljs-number">22</span>ae8f4d-<span class="hljs-number">439</span>d-<span class="hljs-number">437</span>f-<span class="hljs-number">97</span>be-ff5b8363d9aa&#125;<br><span class="hljs-attr">Applications12</span>=&#123;<span class="hljs-number">8</span>d4e2fef-ff16-<span class="hljs-number">4</span>fd8-bac8-<span class="hljs-number">42</span>d47b3ce8c4&#125;<br><span class="hljs-attr">Applications13</span>=&#123;<span class="hljs-number">59584478</span>-<span class="hljs-number">35</span>e1-<span class="hljs-number">4209</span>-ad37-<span class="hljs-number">30</span>c53b6261cc&#125;<br><span class="hljs-attr">SkipLocaleSelection</span>= <span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipSummary</span>= <span class="hljs-literal">YES</span><br><span class="hljs-attr">SkipUserData</span>=<span class="hljs-literal">YES</span><br><span class="hljs-attr">SLShare</span>=\\iphonefintech\Logs<br></code></pre></td></tr></table></figure></li></ul><p><strong>bootstrap</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Settings]</span><br><span class="hljs-attr">Priority</span>=Default<br><br><span class="hljs-section">[Default]</span><br><span class="hljs-attr">DeployRoot</span>=\\<span class="hljs-number">192.168</span>.<span class="hljs-number">135.23</span>\DeploymentShare$<br><span class="hljs-attr">userid</span>=poweruser<br><span class="hljs-attr">userdomain</span>=iphonefintech.com<br><span class="hljs-attr">userpassword</span>=Abc123456<br><span class="hljs-attr">SkipBDDWelcome</span>=<span class="hljs-literal">YES</span><br></code></pre></td></tr></table></figure><p><strong>有关自动化配置和自动化参数的都在上面了，还有更详细更自动化的要自己参考琢磨了，后续也不定期更新其中更细的内容，以上只做参考</strong></p>]]></content>
    
    
    <categories>
      
      <category>WDS+MDT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WDS+MDT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows自动化装机部署（五）Task部署任务创建及磁盘分区驱动对应调整</title>
    <link href="/2021/03/03/MDT/windows_autoinstall_05/"/>
    <url>/2021/03/03/MDT/windows_autoinstall_05/</url>
    
    <content type="html"><![CDATA[<p><strong>Windows自动化部署 Task部署任务创建</strong></p><ul><li>右键Task Sequence，选择New Task Sequence<br><img src="https://upload-images.jianshu.io/upload_images/9650472-994b29f605456f3d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-3db1ea17f83f8485.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-0898837159df0c84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c7d64fc1277609f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-3ca77032bd950723.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><ul><li><p>输入任务ID号，任务名称及描述<br><img src="https://upload-images.jianshu.io/upload_images/9650472-d9110aade509c94c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p></li><li><p>选择部署类型<br><img src="https://upload-images.jianshu.io/upload_images/9650472-d0ade92f28a59d5b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p></li><li><p>选择需要部署的操作系统<br><img src="https://upload-images.jianshu.io/upload_images/9650472-bf420536fcc8b804.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p></li><li><p>暂时不输入密钥<br><img src="https://upload-images.jianshu.io/upload_images/9650472-45d3fa37fdae5e54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p></li><li><p>输入组织信息、主页等信息<br><img src="https://upload-images.jianshu.io/upload_images/9650472-0ab50cacc3a95f4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p></li><li><p>这边为administrator管理员创建密码</p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9fcd24b64e3e10c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-1052847d5884bc47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="12.png"></p><ul><li>任务创建完成<br><img src="https://upload-images.jianshu.io/upload_images/9650472-39397a85d110ab62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="13.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-fb95b9c1ce419383.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15856556031340.png"></p><p><strong>Task任务创建完成后，我们肯定对Task Sequence选项中涉及到的诸多个性化设置很感兴趣，本章中暂不做细化界面介绍。为了后续部署操作的顺利进行，我们需要对部署系统进行磁盘分区及分区格式化调整。接下来我们就来了解一下对应设置的相关配置步骤及注意事项：<br>生产环境中，我们一般有两种需求：一种是全盘格式化进行全新安装；另一种是只格式化系统盘数据，保留其他分区资料信息等；其实不管哪种部署方式我们都需要关注数据的安全性，生产环境中永远把数据安全放在第一位才是王道（注：在很多公司做此类项目的时候总有那么几台本来设置只格式系统盘，但是安装完成后会发现是全盘格式化，暂时未找到根源，所以还是建议大家做好数据备份，相关资料最好日常使用的时候在非系统盘做好备份，同时在安装操作系统的时候对重要数据进行移动外置介质备份，做到防患于未然。）</strong></p><p><strong>磁盘分区调整</strong><br><strong>- 双硬盘</strong> </p><ul><li><p>单击新建任务序列，右键选择属性<br><img src="https://upload-images.jianshu.io/upload_images/9650472-0ef98e32fbba0522.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p></li><li><p>Enable this task sequence ：部署引导过程中显示此task任务</p></li><li><p>Hide this task sequence in the Deployment wizard ：不显示此Task任务<br><img src="https://upload-images.jianshu.io/upload_images/9650472-62c5ca515415533d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p></li><li><p>选择Task Sequence选项<br><img src="https://upload-images.jianshu.io/upload_images/9650472-5ad5d8f26542a8c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p></li><li><p>依次展看Preinstall —New Computer only—Format and Partition Disk<br><img src="https://upload-images.jianshu.io/upload_images/9650472-06b7a9af08144ebe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p></li><li><p>这里MBR格式的我拿来做机械硬盘对半分区<br><img src="https://upload-images.jianshu.io/upload_images/9650472-9e86218a55c04dd5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p></li><li><p>新建一个分区</p></li><li><p>partition name ：磁盘名字</p></li><li><p>Size：分磁盘空间的50%，剩下的给另一个磁盘就是100%<br><img src="https://upload-images.jianshu.io/upload_images/9650472-d679e0e749c54372.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-185ef97c6ddf34a3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p><ul><li><p>分区创建完成后分区信息如下：</p></li><li><p>disk number：机械硬盘我接的是SATA1 这里对应填的就是1</p></li><li><p>disk type : 机械硬盘我采用了MBR格式分区<br><img src="https://upload-images.jianshu.io/upload_images/9650472-c867ad284242d943.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p></li><li><p>固态硬盘的分区，我这里固态硬盘240G全给了做系统，就不做任何改变</p></li><li><p>disk number：固态硬盘我接的是SATA0，这里也就选择0</p></li><li><p>disk type : 固态硬盘的系统我采取用UEFI模式启动，这里就选择GPT模式<br><img src="https://upload-images.jianshu.io/upload_images/9650472-f53319f0ccd86dce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p></li><li><p>勾选Disable this step 可以防止格式化<br><img src="https://upload-images.jianshu.io/upload_images/9650472-3b94231de902fbe5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p></li></ul><p><strong>单硬盘分区</strong></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-b4cb8eab4d4a6f9d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-d24e2358f4ee6e8c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-a58bd7d247789674.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-f4506052c13e9970.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-990081a69265d9e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><p><strong>机型驱动调整</strong> </p><ul><li>这里要选相对应的机型的驱动，驱动是我们之前创建好的，在前面的章节有。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-c87161c24c730bfe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c7d52d907f26a15c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-34387204dab762cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p>磁盘分区就介绍到这里了。</p>]]></content>
    
    
    <categories>
      
      <category>WDS+MDT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WDS+MDT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows自动化装机部署（四）软件参数设置及导入</title>
    <link href="/2021/03/03/MDT/windows_autoinstall_04/"/>
    <url>/2021/03/03/MDT/windows_autoinstall_04/</url>
    
    <content type="html"><![CDATA[<p><strong>上一章我们已经对OS映像及分类导入驱动信息做了介绍，这一章我们针对自动化安装软件设置软件的参数</strong></p><p><strong>常用软件静默安装参数</strong><br> <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs routeros">1. .msi 格式<br>msiexec.exe /i ActiveSync.msi /quiet /norestart<br><br>2. .msp 格式<br>msiexec.exe /p hotfix.msp /quiet /norestart<br><br>3. 系统运行库<br>        ○ Visual C++ 2008 (VC8)解压出来得到msi文件 (官方下载的是exe文件，通过.exe /?查询也是/Q，但部署/Q和/q均报错，所以用解压部署的方法)<br>        ○ Visual C++ 2009(VC9).exe /q<br>        ○ Visual C++ 2010 (VC10).exe /q<br>        ○ Microsoft .NET Framework 1.1解压出来得到msi文件 (官方下载的是exe文件，通过.exe /?查询也是/Q，但部署/Q和/q均报错，所以用解压部署的方法)<br>        ○ Microsoft .NET Framework 2.0.exe /q<br>        ○ Microsoft .NET Framework 3.0.exe /q<br>        ○ Microsoft .NET Framework 3.5.exe /q<br>        ○ Microsoft .NET Framework 4.0.exe /q<br><br>4. 系统常用<br>        ○ Windows补丁，通常都是/quiet /norestart即可。如WindowsXP-KB915865-v11-x86-CHS.exe<br>        ○<br>        ○ WinRAR.exe /S<br>        ○ 7-ZIP.exe /S<br>        ○ Google拼音.exe /S<br>        ○ 搜狗拼音.exe /S<br>        ○ 驱动精灵2012.exe /S<br>        ○ CPU-Z v1.60 官方中文安装版.exe /S<br>        ○ Google Picasa v3.9.135.93 官方简体中文版.exe /S<br>        ○ 迅雷看看播放器 v4.8.8.966.exe /S<br>        ○ 网易有道桌面词典 5.0 正式版.exe /S<br>        ○ 微软雅黑字体<span class="hljs-keyword">for</span> XP.exe /Q<br>        ○ VMware-workstation-full-8.0.2-591240.exe /silent /noSilentReboot<br><br>5. 即时通讯<br>        ○ 阿里旺旺淘宝买家版 2011 正式版 SP1.exe /S<br>        ○ 飞信 2012 贺岁版 v4.7.0.exe /S<br>        ○ 腾讯 QQ 2011 正式版.exe /S<br>        ○ 腾讯 TM 2009 Beta v3.3.exe /S<br>        ○ 腾讯通 RTX 2011 正式版.exe /S<br><br>6. 文字办公<br>        ○ Office 2003 Professional<br>方法1：<br>对office2003原始安装光盘进行重新封装（也称：管理员安装方式），使其支持网络安装。运行原始安装光盘下的Setup.exe /a，然后输入序列号，选择一个文件夹作为office安装点。（如在硬盘上的d:\office）<br><br>运行msiexec.exe /i Pro11.msi /quiet /norestart即可<br>方法2：<br>Step3：制作定制安装的MST文件：运行office 2003<span class="hljs-built_in"> resource </span>kit工具的Custom Installation Wizard，创建一个对应的MST文件，存放在Office 2003目录下。（在setup和pro11.msi文件同一目录）<br>msiexec.exe /a pro11.msi /p setup.msp<br>        ○ Office 2003 兼容包<br>FileFormatConverters.exe /quiet /norestart<br><br>        ○ Office<span class="hljs-built_in"> System </span>2007 /Office<span class="hljs-built_in"> System </span>2010  (包括Project/Visio)<br>运行setup.exe /admin，用Office 2007自定义工具生成.msp文件（包含同意许可协议、序列号、注册信息、显示级别等内容），msp文件名字可随意取。(下图 为：Auto_Office_2007.msp，其它的msp是Office 2007<span class="hljs-built_in"> Service </span>Pack 3运行/extract后解压出来的安装文件)<br><br>将定制后的msp放到Office 2007/2010的Updates目录后，运行根目录下的setup.exe 即可实现全自动安装（office 2007/2010的Service Pack补丁包同样适用，放入Updates目录即可）<br>另外要集成Office 2007或2010的Service Pack，只需要运行Service Pack的exe安装程序后加/extract参数到Office 的Updates目录即可。<br>        ○ Adobe PDF Reader v9.1.exe /sAll<br>        ○ Adobe Acrobat X Pro v10.1.0<br>解压出来，得到msi文件，msiexec.exe /i AcroPro.msi /quiet /norestart<br>        ○ Foxit PDF Reader v5.1.0.1117.exe /S<br>        之前的版本是 -i<br>        ○ Foxmail.exe 6.0.exe /sp- /verysilent /norestart<br>        ○ Google金山词霸.exe  /S<br><br>7. 网络与安全<br>        ○ 微软TMG防火墙客户端<br>msiexec.exe /i TMGClient.msi  <span class="hljs-attribute">ENABLE_AUTO_DETECT</span>=1 <span class="hljs-attribute">REFRESH_WEB_PROXY</span>=1 /quiet /norestart<br>        ○ Adobe Flash Player ActiveX <span class="hljs-keyword">for</span> IE v11.3<br>10之前的版本好像是/S，之后的版本通过查询注册表得知静默安装是/install，卸载是-maintain activex<br>        ○  IE 8<br>IE8-WindowsXP-x86-CHS.exe /quiet /update-no /promptrestart<br>        ○ Microsoft Security Essential (MSE)<br>mseinstall_xp_v2.1.1116.exe /s /q /o /runwgacheck<br>        ○ 360安全卫士.exe  /S<br>        ○ 超级兔子.exe  /S<br>        ○ PPLive.exe /S<br>        ○ 迅雷.exe  /S<br><br>8. 手机相关<br>        ○ 91手机助手<br>需要Microsoft .NET Framework 2.0，msiexec.exe /i netfs.msi  /quiet /norestart<br>91mobilesetup_v3.1.8.583.exe /sp- /verysilent /norestart<br>        ○  iTunes<br>解压出来均是msi格式文件，只需要注意参考下面的安装顺序即可<br>(1) AppleApplicationSupport.msi<br>(2) AppleMobileDeviceSupport.msi<span class="hljs-string">&quot;</span><br><span class="hljs-string">(3) AppleSoftwareUpdate.msi&quot;</span><br>(4) Bonjour.msi<span class="hljs-string">&quot;</span><br><span class="hljs-string">(5) iTunes.msi&quot;</span><br>        ○ Nokia 套件<br>同理解压出来均是msi文件，顺序：<br>(1) Packages\CCD\Setup\Nokia_Connectivity_Cable_Driver.msi<br>(2) Packages\PCCS\Setup\PCCS.msi<br>(3) Packages\VC80_x86\Setup\VC80_x86_v2.msi  或 Packages\VC80_x64\Setup\VC80_x64_v2.msi<br>(4) Packages\Nokia_Suite\Setup\Nokia_Suite.msi<br><br>9. 设计类<br>        ○ AutoCAD 2004/AuctoCAD 2007<br>找到AutoCAD\ACAD.msi文件,参数为<br>msiexec.exe /i  acad.msi <span class="hljs-attribute">ACADSERIALPREFIX</span>=&lt;序列号前缀:111&gt; <span class="hljs-attribute">ACADSERIALNUMBER</span>=&lt;序列号:20111111&gt;  <span class="hljs-attribute">ACADFIRSTNAME</span>=&lt;注册者姓&gt; <span class="hljs-attribute">ACADLASTNAME</span>=&lt;注册者名&gt; <span class="hljs-attribute">ACADORGANIZATION</span>=&lt;注册单位&gt;  <span class="hljs-attribute">ACADDEALER</span>=&lt;经销商&gt;  <span class="hljs-attribute">ACADDEALERPHONE</span>=&amp; lt;经销商电话12345&gt;  /quiet<br>        ○ Google SketchUp v8.0.11752 中文免费版<br>解压得到msi<br>        ○ CorelDraw 较老版本：<br>Setup32.exe /silent（很少界面的静默安装）；新版本是MSI<br></code></pre></td></tr></table></figure></p><p><strong>一、软件导入</strong></p><ul><li>应用程序建立文件夹<br><img src="https://upload-images.jianshu.io/upload_images/9650472-743eb760da948203.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></li><li>对应文件夹名称<br><img src="https://upload-images.jianshu.io/upload_images/9650472-f2ca09bd8463baf7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-dcb14770b6fe25cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-8f458d67bdedc0c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><ul><li> 新建New Application导入软件应用<br><img src="https://upload-images.jianshu.io/upload_images/9650472-c7a4f72929964ada.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-95ee9544f848c1b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p><ul><li><p>指定版本、名称和语言<br><img src="https://upload-images.jianshu.io/upload_images/9650472-fe2123e12a4cedd0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p></li><li><p>选择应用程序存放目录位置<br><img src="https://upload-images.jianshu.io/upload_images/9650472-4b0834e42d2d9848.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-82c212b5b551901b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p><ul><li><p>即将创建的目录名称<br><img src="https://upload-images.jianshu.io/upload_images/9650472-23f60b9f67718467.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p></li><li><p>应用程序执行安装命令<br><img src="https://upload-images.jianshu.io/upload_images/9650472-162570e5514c4b3a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-ec739ee1768e40cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="12.png"></p><ul><li><p>完成应用程序的添加<br><img src="https://upload-images.jianshu.io/upload_images/9650472-78f1c3f2ca653043.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="13.png"></p></li><li><p>相对应的文件夹下也捕获到了应用程序<br><img src="https://upload-images.jianshu.io/upload_images/9650472-a2f98e63115c7d3d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_1585647070184.png"></p></li><li><p> 双击新添加Application查看对应属性如下<br><img src="https://upload-images.jianshu.io/upload_images/9650472-4cc0f047825a9ec5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="14.png"></p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-b64647ba7b50db3b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="15.png"></p><p><strong>到这里我们就完成了应用程序的导入安装，前提下可以在电脑设置好默认参数，编写成bat脚本去跑一编，确定没问题了，在放到mdt上去，静默安装参数可以参考上面。</strong></p>]]></content>
    
    
    <categories>
      
      <category>WDS+MDT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WDS+MDT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows自动化装机部署（三）镜像驱动程序导入</title>
    <link href="/2021/03/03/MDT/windows_autoinstall_03/"/>
    <url>/2021/03/03/MDT/windows_autoinstall_03/</url>
    
    <content type="html"><![CDATA[<p>在上文配置好WDS、MDT控制台后，接下来我们就可以开始我们后续的分目录导入OS映像、各系统版本驱动、软件。</p><p><strong>一、目录结构创建：</strong></p><ul><li>打开MDT控制台</li><li>右键operating system选择New Folder</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9ed7fcf5d19de793.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p><ul><li>根据实际环境输入目录名称<br><img src="https://upload-images.jianshu.io/upload_images/9650472-589a5599bd898431.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-e62ca9e5bc443902.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-8d1de2d157397ae8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><ul><li>创建完成后控制台信息如下<br><img src="https://upload-images.jianshu.io/upload_images/9650472-2d9feab0e43dcd0e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></li></ul><p><strong>二、导入镜像</strong></p><ul><li><p>选中对应文件夹，右键“Import Operating System”<br><img src="https://upload-images.jianshu.io/upload_images/9650472-96805b85d4e17055.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p></li><li><p>这里我选择“Full set of source files”,可根据自己实际情况选择。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-401f4c67196ddd9e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-8dafc8f427713fb0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-a17feb3af0498e52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p><ul><li>输入操作系统描述名称<br><img src="https://upload-images.jianshu.io/upload_images/9650472-5361fd3fe32aab2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9e9c2c9cbf0ce1bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></p><ul><li><p>导入镜像完成<br><img src="https://upload-images.jianshu.io/upload_images/9650472-60b1d4a1d54bdd77.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="12.png"></p></li><li><p>导入后控制台显示<br><img src="https://upload-images.jianshu.io/upload_images/9650472-b009923ebaccb78a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="13.png"></p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-d318acd275111aca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="14.png"></p><p><strong>三、下载对应机型驱动程序：</strong></p><ul><li><p>以Dell 3046 主机为例</p></li><li><p><a href="https://www.dell.com/support/article/zh-cn/sln312414/dell-command-deploy-driver-packs-for-enterprise-client-os-deployment">Dell 驱动程序下载</a></p></li><li><p>ctrl+F 搜索<br><img src="https://upload-images.jianshu.io/upload_images/9650472-93730e478de24476.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p></li><li><p>下载<br><img src="https://upload-images.jianshu.io/upload_images/9650472-b7c66dff17904cda.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p></li><li><p>解压到文件夹<br><img src="https://upload-images.jianshu.io/upload_images/9650472-a88196eec71ab92d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p></li></ul><p><strong>四、导入驱动程序：</strong></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-ee71acbfe2be102b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-3614a28a124dda16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-f2129f1f6eb8986b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9995f55222972463.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-10c2fa85efec1883.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-dfc2910c8ffe0d32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-caa8db3d919fe8c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-24d0139008459db8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p><ul><li>导入后驱动视图与目录相对应<br><img src="https://upload-images.jianshu.io/upload_images/9650472-5e0d425221332ef1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></li></ul><p><strong>五、建立每个机型驱动包文件：</strong></p><ul><li>新建profile<br><img src="https://upload-images.jianshu.io/upload_images/9650472-2bcd8eec736abbe8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></li><li>命名相对应机型的驱动<br><img src="https://upload-images.jianshu.io/upload_images/9650472-9e53d055aead076f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></li><li>选择已导入的相对应驱动<br><img src="https://upload-images.jianshu.io/upload_images/9650472-1a5cebf0092a4846.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-0a6db69cc4f550bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-04fd81f64a5be2af.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><ul><li>刷新后查看导入成功<br><img src="https://upload-images.jianshu.io/upload_images/9650472-4882fddf0cab080c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></li></ul><p><strong>生产或测试环境中，我们可能在控制台建立对应的分类目录后，在最终生成的目录中是按MDT自己的命名规则去分类的，新建每个机型相对应的驱动程序包，方便后续每个机型安装系统驱动都是相对应的。</strong></p>]]></content>
    
    
    <categories>
      
      <category>WDS+MDT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WDS+MDT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows自动化装机部署（二）MDT环境准备</title>
    <link href="/2021/03/03/MDT/windows_autoinstall_02/"/>
    <url>/2021/03/03/MDT/windows_autoinstall_02/</url>
    
    <content type="html"><![CDATA[<p><strong>1.下载并安装 Windows ADK</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-ca7987e1a2ae5828.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></p><ul><li>这里我选择默认路径，也可以选其他路径<br><img src="https://upload-images.jianshu.io/upload_images/9650472-2ca55395a29a2116.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-750445ef0ed35b4c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-d456b420e0347672.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p><ul><li><p>可根据实际需求选择所要安装的功能<br><img src="https://upload-images.jianshu.io/upload_images/9650472-2a2ef7e136a35f37.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p></li><li><p>暂时不启动”开始指南”<br><img src="https://upload-images.jianshu.io/upload_images/9650472-4d5f5aa79627f016.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="07.png"></p></li></ul><p><strong>2.下载并安装MDT2013</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-c44abeb5067abb4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-734e278c081e01cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-e430026d81bfe300.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p><ul><li>暂时不加入，直接选择“Next”<br><img src="https://upload-images.jianshu.io/upload_images/9650472-a638fd8be3b53a4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-085fc4832b7694d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-0ccea74530097786.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="06.png"></p><p><strong>服务器端：AD、DNS、DHCP<br>客户端：MDT、WDS、ADK 8.1<br>服务端与客户端所需的环境准备条件到此完成。<br>在设置准备好MDT环境后，我们需要对MDT、WDS等进行首次使用的简单设置，以方便后续OS、驱动等的导入及分发部署。</strong></p><p><strong>3.windows部署服务配置</strong></p><ul><li>打开windows部署服务控制台</li><li>右键MDT服务器，选择配置服务器<br><img src="https://upload-images.jianshu.io/upload_images/9650472-697f8d9e7353f2bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-de86241647878fa5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-ed0b3acb10c364fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-7e9822fbe7378976.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-22b47c0941b3329a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p><ul><li><p>配置界面<br><img src="https://upload-images.jianshu.io/upload_images/9650472-a0a2d89af05ca950.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></p></li><li><p>WDS控制台配置好后会在安装后指定文件下生成相应的文件目录<br><img src="https://upload-images.jianshu.io/upload_images/9650472-c53780da6d3f7232.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p></li></ul><p><strong>4.MDT服务台配置</strong></p><ul><li>打开 MDT 控制台“Deployment Workbench”并新建<br><img src="https://upload-images.jianshu.io/upload_images/9650472-0bb3dd3e4ee4887d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-8c93a6a9e4526d5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><ul><li>指定网络共享路径，可以自定义设置。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-9f29bc16ad79e33e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></li></ul><ul><li>设置共享名称<br><img src="https://upload-images.jianshu.io/upload_images/9650472-64a19a86afdd5896.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></li></ul><ul><li>设置共享描述<br><img src="https://upload-images.jianshu.io/upload_images/9650472-fb94d290710eb76b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></li></ul><ul><li>相关选项，可根据需要勾选，这里全不选。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-6b1acd8739d8df9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="06.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-dd7f115f8bf9d72b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="07.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-3fbefdb4e558c32d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="08.png"></p><ul><li><p>配置完成后视图如下，互相对应的<br><img src="https://upload-images.jianshu.io/upload_images/9650472-759e9a91897f6a10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="09.png"></p></li><li><p>各目录互相对应的信息<br><img src="https://upload-images.jianshu.io/upload_images/9650472-69c8323975b7385a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="010.png"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>WDS+MDT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WDS+MDT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows自动化装机部署（一）WDS环境准备</title>
    <link href="/2021/03/03/MDT/windows_autoinstall_01/"/>
    <url>/2021/03/03/MDT/windows_autoinstall_01/</url>
    
    <content type="html"><![CDATA[<h1 id="整个流程的图吗，个人觉得很清晰，网络上找到。-重要！！"><a href="#整个流程的图吗，个人觉得很清晰，网络上找到。-重要！！" class="headerlink" title="整个流程的图吗，个人觉得很清晰，网络上找到。(重要！！)"></a><strong>整个流程的图吗，个人觉得很清晰，网络上找到。(重要！！)</strong></h1><p><img src="/img/MDT/MDT_01.jpg"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-1defde2ccc6e5a8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15852809188763.png"></p><p>AD（DC）:Windows部署服务器必须是Ad域的成员，或者域控制器，在这里我们的WDS是属于域成员。<br>DNS：网络中需要有效的DNS服务器<br>DHCP:windows部署服务依靠DHCP进行IP寻址PXE，因此网络中必须要有有效的DHCP服务器，在我们这里DHCP设置在思科交换机中。<br>WDS:Windows 部署服务（Window Deployment Services）<br>MDT：MicrosoftDeploymentToolkit，系统部署工具</p><p><strong>一、 安装准备</strong></p><p>首先介绍本次项目所涉及到的内容：</p><p> <strong>MDT</strong> <br>    Microsoft Deployment Toolkit 2012（简称MDT 2012）是<a href="http://baike.baidu.com/view/2353.htm">微软</a>最新一代部署工具，通过它可以自动完成<a href="http://baike.baidu.com/view/79807.htm">桌面</a>和服务器部署的推荐操作进程和工具，MDT主要是为大型或者中型企业部署windows 系列操作系统的部署工具，用MDT部署能大大减少系统管理员的工作，提高系统稳定性，安全性和持续的配置管理，以及方便统一大量部署。</p><p>MDT 2012新增功能：<br>可以从任何地方通过网络访问部署状况，跨区域复制文件或是进行系统设置；<br>为组织管理驱动、操作系统、应用、软件包和任务进程提供了改进的用户界面；</p><p><strong>必要组件</strong></p><p>windows ADK<br>     Windows 评估和部署工具包 (Windows ADK) 是一组可用来自定义 Windows pc和 Windows Server 操作系统并将其部署到新的计算机和服务器的工具和文档。 <br>**WDS **<br>   Windows deploy sever (windows 部署服务 WDS) 是 windows Server 2008 中部署OS（操作系统）的一个利器，顾名思义WDS 是针对大容量部署操作系统而设置的（部署是针对批量操作系统的安装，有的时候还需要考虑设置相同的桌面环境，这个角色是通过网络来安装操作系统，这样可以避免亲自在每台机器上做操作，而且还省去了通过光盘（这么不环保的”东西”）来安装操作系统的过程。 </p><p><strong>MDT与WDS的区别：</strong><br>    MDT是一款最新部署工具，其中他的自动部署和应用、软件包任务序列是它的亮点，它可以将以上的应用和软件包集成到系统，最后加上他的完美自动部署脚本使整个部署简单化，既省时又方便管理。<br>WDS他也可以进行部署操作系统，只是单一将OS，软件等加载进去，最后还是需要人为干预进行部署。<br>现在将两者结合起来，基本可以实现所需功能，由于MDT不能单独引导PXE启动，而WDS有为客户机提供PXE引导的功能，因此所以选择了WDS+MDT模式。</p><p>MDT工具我选择MDT2013  下载地址：<a href="https://www.microsoft.com/en-us/download/details.aspx?id=48595">https://www.microsoft.com/en-us/download/details.aspx?id=48595</a><br>ADK win10  下载地址：<a href="https://docs.microsoft.com/zh-cn/windows-hardware/get-started/adk-install">https://docs.microsoft.com/zh-cn/windows-hardware/get-started/adk-install</a></p><p>1.<strong>机子需要加域</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-f6cccd28417ad7bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15853033032537.png"></p><p><strong>2.添加Windows部署服务及 .NET Framework3.5 功能</strong></p><ul><li>放个镜像包然后装载后续会用到<br><img src="https://upload-images.jianshu.io/upload_images/9650472-5b817346e1846d8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-78ca552835f45cf8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-f85804f2dd6b862e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-6328bad54c7a9ddf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-7c786ddc5da2a415.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9cc5aee7d92baeaa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-a38c569c9f2326d2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-407dd69e774a8dd2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-72c9dc4849158391.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-65b24dc9a442c0da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-420dcebddd016e73.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15853941264482.png"></p>]]></content>
    
    
    <categories>
      
      <category>WDS+MDT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WDS+MDT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Exchange Server 2016 遇到的一些问题错误解决方法</title>
    <link href="/2021/03/03/Exchange2016/exchange2016_other_01/"/>
    <url>/2021/03/03/Exchange2016/exchange2016_other_01/</url>
    
    <content type="html"><![CDATA[<p><strong>邮件发送到外部邮箱账号失败</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-2bf9e4f161cdd26d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p><p>– 然后重新配置了<strong>邮件流-发送连接器-发送internet</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-3ceb37bf0c27cba3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c914c1276ab743af.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-343e620753a7d145.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-febd0e2c54b4458f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9365ed7ac78f3c5e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-5e08bd6aa12595ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9432e4ebfe7ded1e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-26bfffe2839aeafe.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>Exchange2016</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Exchange2016</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Exchange Server 2016 部署系列（六）高可用 DAG</title>
    <link href="/2021/03/03/Exchange2016/exchange2016_06/"/>
    <url>/2021/03/03/Exchange2016/exchange2016_06/</url>
    
    <content type="html"><![CDATA[<p><strong>见证目录权限配置</strong><br>本次实验中将使用DC作为见证服务器，需要将Exchange Trusted Subsytem组加入到见证服务器的本地Administrators组中，在DC中需要使用AD用户和计算机来添加</p><ul><li><p>添加Exchange Trusted Subsytem组到Administrators组中<br><img src="https://upload-images.jianshu.io/upload_images/9650472-7c02cd9000f9f816.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p></li><li><p>在域控制器上，打开Active Directory用户和计算机，展开域节点“computer”，在右侧窗口中点击右键，选择“新建”-“计算机”，输入DAG群集计算机名称DAG01，点击“确定”。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-b56a2ad15950a0e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-d197957418312ec6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="3.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-d62f0746b2932ceb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.png"></p><ul><li><p>需要将权限分配给 CNO，在Active Directory用户和计算机中点击“查看”，勾选“高级功能”，选择创建的计算机DAG01右键属性，却换到隶属于选项卡，点击“添加”，将计算机DAG01添加到Exchange Trusted Subsytem组中。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-9f7222bc35abe5f3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p></li><li><p>新建DAG存放文件夹<br><img src="https://upload-images.jianshu.io/upload_images/9650472-8dac10a81b727046.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.png"></p></li></ul><ul><li>新建数据库可用性组，填入DAG名称、见证服务器名称、DAG IP地址等，点击“确定”,见证目录可不填，DAG会在见证服务器上自动创建见证目录，也可自己指定。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-2e45a595f5665e44.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-b922e17ec4341ea5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.png"></p><ul><li>点击“管理DAG成员资格”图标，单击“+”，从列表选择服务器Contso-EX01 Contso-EX02，单击“添加”，然后单击“确定”，单击“保存”，以保存更改。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-3781ee49dfffad2d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-1aea42975aef22b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p><ul><li><p>等“保存已成功完成“后，单击“关闭<br><img src="https://upload-images.jianshu.io/upload_images/9650472-cb5e6ccd7dda868b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></p></li><li><p>将DAG网络修改成手动方式<br><img src="https://upload-images.jianshu.io/upload_images/9650472-11663e361d03249c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="12.png"></p></li><li><p>添加数据库副本到另一台服务器，点击新建的数据库名称，然后点击 “．．．”. 来添加副本数据库。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-29844f532d9eb564.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="13.png"></p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-a5fd54c02e51dda0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="14.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-34a48f4c402a822b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="15.png"></p><ul><li>添加完成<br><img src="https://upload-images.jianshu.io/upload_images/9650472-bf1282e0321a49a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="16.png"></li></ul>]]></content>
    
    
    <categories>
      
      <category>Exchange2016</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Exchange2016</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Exchange Server 2016 部署系列（五）基础配置</title>
    <link href="/2021/03/03/Exchange2016/exchange2016_05/"/>
    <url>/2021/03/03/Exchange2016/exchange2016_05/</url>
    
    <content type="html"><![CDATA[<p><strong>虚拟目录</strong><br><strong>自动发现配置</strong><br>有的朋友可能知道，虽然在虚拟目录里有自动发现这个选项，但自动发现记录在图形化界面无法配置自动发现地址，如图所示。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-4d8a5aafd92e5d42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_1585105398994.png"></p><ul><li>其实自动发现路径需要使用命令修改，我们先查下现在的自动发现写的是什么</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">查看自动发现配置情况命令：<br><span class="hljs-keyword">Get</span>-ClientAccessService | <span class="hljs-keyword">select</span> <span class="hljs-type">Name</span>,AutoDiscoverServiceInternalUr<br></code></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9bbb84af2e6232ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_1584955914303.png"></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c">修改自动发现命令：<br>Get-ClientAccessService <span class="hljs-string">| Set-ClientAccessService -AutoDiscoverServiceInternalUri &quot;</span>[https:<span class="hljs-comment">//mail.iphonefintech.com/Autodiscover/Autodiscover.xml](https://mail.iphonefintech.com/Autodiscover/Autodiscover.xml)</span><br><br></code></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9650472-763b487f6aed4fe1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15849561101075.png"></p><ul><li>至此我们就修改完成了自动发现</li></ul><p><strong>ECP配置</strong></p><ul><li>参照截图，导航到服务器-虚拟目录-Ecp-修改<br><img src="https://upload-images.jianshu.io/upload_images/9650472-f2b9a0a1f2fabbfc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15849582118425.png"></li></ul><ul><li>参照截图，修改ECP路径，内外网路径可以一样也可以不一样，如图所示<br><img src="https://upload-images.jianshu.io/upload_images/9650472-15cbfc1079bee82a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_1584958260703.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c9d59f9e544c20b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15849583734021.png"></p><ul><li>参照截图，导航到服务器-虚拟目录-Owa-修改</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-546ba7d918579b1a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_1584958406980.png"></p><ul><li>参照截图，修改Owa路径，内外网路径可以一样也可以不一样，如图所示<br><img src="https://upload-images.jianshu.io/upload_images/9650472-69d5ac02ffab1c4e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15849584492008.png"></li></ul><p><strong>EWS配置</strong></p><ul><li><p>同样，导航到服务器-虚拟目录-EWS-修改<br><img src="https://upload-images.jianshu.io/upload_images/9650472-80957301d9385c24.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15849585109067.png"></p></li><li><p>修改内外网访问路径<br><img src="https://upload-images.jianshu.io/upload_images/9650472-35b898ba0a5d2c33.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_1584958550525.png"></p></li></ul><p><strong>MAPI配置</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-21ecc96b97a53a12.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15851097732013.png"></p><ul><li>修改内外网访问路径<br><img src="https://upload-images.jianshu.io/upload_images/9650472-af5e5715fa0b42a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15849586437630.png"></li></ul><p><strong>ActiveSync修改配置</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-75df2986103d7af9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15849587097603.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9abca3e343de999f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_1584958741188.png"></p><p><strong>OAB修改配置</strong></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-95a6ddbef631020c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15849587919189.png"></p><ul><li>修改内外网访问URL<br><img src="https://upload-images.jianshu.io/upload_images/9650472-5d1f7e4d4a36b607.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15851102118147.png"></li></ul><p><strong>PowerShell修改配置</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-84b00042047dc705.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15849588477614.png"></p><ul><li>修改内外网访问URL<br><img src="https://upload-images.jianshu.io/upload_images/9650472-db17949dc42dd763.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15849588832832.png"></li></ul><p><strong>接收域配置</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-df88b87cb42c69e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15851107143742.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-f5c78c14809b8290.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_1585110756146.png"></p><p><strong>地址策略配置</strong></p><ul><li>打开ECP导航到邮件流-电子邮件地址策略-+</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-39cb94012668264a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-e943a277e12c2db5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-5f1896de748549ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c737f26def1a61c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-e5b4580771e70e02.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-501d6fd6bfd6925c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="06.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-069b80b03ac4dd8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="07.png"></p><p><strong>数据库创建</strong></p><ul><li>打开ECP，导航到服务器-数据库-“+”</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-86af06ba138b4123.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-d61ad789ec7405b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><ul><li><p>输入数据库名称、路径、与Log路径，大家可能看到了我的数据库EDB文件路径与Log不在同一路径下，这个是最佳实践的建议。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-e07a8fa4688675f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p></li><li><p>重启相关服务器即可<br><img src="https://upload-images.jianshu.io/upload_images/9650472-2400698f5b58ca6c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-08b88576957ac9ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p><ul><li><p>数据库创建完成。第一篇架构设计时候我们说了，大领导的邮箱配额是5G，我们直接修改数据库的配额即可。或者单个用户去修改<br><img src="https://upload-images.jianshu.io/upload_images/9650472-d40838ca3c341c27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="06.png"></p></li><li><p>参照截图修改数据库配额，这里修改完成后在该数据库里的所有用户邮箱配额都是5G<br><img src="https://upload-images.jianshu.io/upload_images/9650472-1ae903bd479b3750.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="07.png"></p></li></ul><p><strong>新建用户</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-2acb82b3c3985069.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_1584976211327.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9e2db19ca9f40da1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15849762634252.png"></p><p><strong>发送连接器配置</strong></p><ul><li>如果要将邮件发送到 Internet，需要在邮箱服务器上创建发送连接器。<br>打开EAC管理控制台，转到“邮件流”，并切换到“发送连接器”。在“发送连接器”页上，单击“+”  ，新建发送连接器.<br><img src="https://upload-images.jianshu.io/upload_images/9650472-755bcf04454cf86f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-823e0cfa6a93a84c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><ul><li>通过DNS路由，解析收件人关联的MX记录；或添加邮件网关。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-e62a6816d6a7b00e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-0bdfd0dbc864c3ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-db28b13802f8f2d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9fd6967bdad292ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="06.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-8e69e32ce7b03f88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="07.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-1fbc00c5c499704e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="08.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-88d600d96c3b4444.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="09.png"></p><p><strong>接收连接器配置</strong></p><ul><li><p>接收连接器默认有5条策略，分属2种角色，</p></li><li><p>前端传输（FrontendTransport）：Client Frontend EX01、Default Frontend EX01、Outbound Proxy Frontend EX01；</p></li><li><p>集线器传输（HubTransport）：Client Proxy EX01、Default EX01；</p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-ce0d879bcaf04e85.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-aea680e21a395022.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-2249bb2e785b5296.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-da785b5bbc8be8d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p><p>其他基本也是一样的，这里就不做操作了。</p>]]></content>
    
    
    <categories>
      
      <category>Exchange2016</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Exchange2016</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Exchange Server 2016 部署系列（四）基础配置</title>
    <link href="/2021/03/03/Exchange2016/exchange2016_04/"/>
    <url>/2021/03/03/Exchange2016/exchange2016_04/</url>
    
    <content type="html"><![CDATA[<p>我们在上一篇中完成了Exchange Server 2016 CU15的安装,接下来我们将进入配置相关内容,首先我们将会进行DNS记录配置，证书配置，证书申请，证书导入。</p><p><strong>1.DNS记录配置</strong><br>部署过Exchange Server的朋友可能知道，部署完成Exchange后，只能使用IP或者LocalHost方式访问，除非您在您的DNS里添加A记录，才能以配置的域名去访问登陆，首先就要在域的DNS里创建一个的DNS域。</p><ul><li>打开DNS新建区域，使用Mail.iphonefintech.com访问邮件，所以作用域就是iphonefintech.com,所以我们这里输入iphonefintech.com即可<br><img src="https://upload-images.jianshu.io/upload_images/9650472-036997e559a17a81.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-72c31d6ac3c4d2ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-407f84847497d689.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-833ce307404388da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-e8237075d3cef1cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c55dc10f614c3e2d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="06.png"></p><ul><li>DNS上启用了DNS轮训功能,然后在刚刚建的区域上创建A记录，输入第一台邮件服务器的命名及ip，再创建一个输入第二台。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-0bd09519fe9e8265.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-50e0dace70491631.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-ecf9b81dc233129e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-d74d0f759d6af5df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-25d63cab96a6bc2b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p><p><strong>2.证书配置</strong><br>DNS轮训配置完成后，我们是可以使用sz-ad-02.iphonefintech.com访问邮件了，但网页会报证书错误，我们要解决这个问题只能使用公网证书或者使用内网证书在EX上绑定，为了掩饰证书安装，我这里就用内网证书了。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-5421ccbcf45f21d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="企业微信截图_15847837627110.png"></p><p><strong>2.1AD证书安装</strong></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-d64876e6ce077b83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-70ac1085db6e5ec8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-efcb346e2d080223.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-20adffd50fb85016.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-53cf185fbb72fb2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c0491a2dc37ff0b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="06.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-edf8a2555003824f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="07.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-b7f8393d641d32e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="08.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-998f51e95ef6674e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="09.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c389ed4008b6ce01.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-6d896385be8facb7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></p><p><strong>2.2AD CS证书配置</strong></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-e553a6c5d3bdfac6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-f0a98429a36aa0c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-cdc731369ba94e03.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p><ul><li>该步骤我们一定要选择“企业CA”<br><img src="https://upload-images.jianshu.io/upload_images/9650472-e420ca481cc12b07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></li><li>由于我们这台CA是第一台CA，所以我们选择跟CA即可<br><img src="https://upload-images.jianshu.io/upload_images/9650472-7d784fa45bd05867.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-eca173118a534f06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="06.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9d3f0cf629b70027.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="07.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-402a6035cd0bb956.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="08.png"></p><ul><li>默认的CA是5年，实际环境建议设置大点，避免过期，过期了就不好玩了</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c97544f7b5deb731.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="09.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-0eee5ccc1a438936.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-afda678cf8521a16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></p><ul><li>至此我们CA就配置完成了</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-af3be378175ee617.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="12.png"></p><p><strong>3.证书申请</strong></p><ul><li>打开Exchange 服务器的ECP</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-34e0bf7ff5f979db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-1cda7a63181e7d52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><ul><li><p>证书友好名称根据自己的习惯填写就可以了<br><img src="https://upload-images.jianshu.io/upload_images/9650472-1c2225101e1700c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p></li><li><p>如果想使用通配符证书，这里就可以配置，我这里就不使用通配符证书了<br><img src="https://upload-images.jianshu.io/upload_images/9650472-dde00e866ff7b697.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p></li><li><p>选择证书存储服务器<br><img src="https://upload-images.jianshu.io/upload_images/9650472-cc2138b9dae0a05d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-7e2ab520a5978194.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="06.png"></p><ul><li>上面如果没有配置，这里直接添加即可，由于后期我们还需要使用OOS服务器，所以我把OOS的域名就一并申请下来了。<br><img src="https://upload-images.jianshu.io/upload_images/9650472-e87d2cf7fe8f257e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="07.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-e92a14db3c891a84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="08.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-23704c10c2bd3049.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="09.png"></p><ul><li>选择证书申请文件存储位置，这里的位置必须是共享路径<br><img src="https://upload-images.jianshu.io/upload_images/9650472-9f152f483c8480ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></li></ul><p><strong>3.1CA证书申请</strong></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-a4fc02c5af90bf9f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-3d90ac1f9772cea8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-1007e7153a04d199.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-5154511bb82cdad3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p><ul><li> 打开刚才创建的申请文件，复制粘贴填入，选择web服务器<br><img src="https://upload-images.jianshu.io/upload_images/9650472-630235af4d934bdc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="06.png"></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-03f6fde704c9c37c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="07.png"></p><ul><li>下载证书<br><img src="https://upload-images.jianshu.io/upload_images/9650472-eba47b3aebd932ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="08.png"></li></ul><p><strong>4证书导入到出</strong><br><img src="https://upload-images.jianshu.io/upload_images/9650472-ececbed167eba3c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="01.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-a71dbb538b5bcfbf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="02.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c43223da4f18e008.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="03.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-3db3423fd1858af4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="04.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-c44ce8e1f08cf9b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="05.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9c76c769f898d3b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="06.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-1a60678e5dcb467c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="07.png"></p><ul><li>我们完成了第一台服务器的证书导入与服务的分配工作，接下来我们进行第二台服务器的证书导入与分配工作。</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/9650472-baf499ea9128f59a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="08.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-9254c99204d48245.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="09.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-435f92308e1607ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="10.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-ba358ac83ac13f27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-20260e356317e15a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="12.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-16ebb3a2e6652ced.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="13.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-b6d0ea56ccc20eb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="14.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-1668ac280dc49b3b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="15.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9650472-699527ff99694aa4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="16.png"></p><ul><li>这个时候我们在登录就不会报证书错误了<br><img src="https://upload-images.jianshu.io/upload_images/9650472-ff145a750f1df333.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="17.png"></li></ul>]]></content>
    
    
    <categories>
      
      <category>Exchange2016</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Exchange2016</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Exchange Server 2016 部署系列（三）环境准备</title>
    <link href="/2021/03/03/Exchange2016/exchange2016_03/"/>
    <url>/2021/03/03/Exchange2016/exchange2016_03/</url>
    
    <content type="html"><![CDATA[<p>上一章Exchange Server 2016 部署系列（二)环境准备部署篇我们对部署AD已经准备完成了，接下来我们进入对Exchange Server 2016的搭建。<br><strong>ExSrv01（第一台邮件服务器）:入域到AD上，这一步我就不再操作了直接开始安装组件，远程管理包，exchange 2016。</strong></p><p><img src="/img/Exchange2016/exchange_52.jpg"><br><img src="/img/Exchange2016/exchange_52_01.jpg"><br>首先我们先安装组件这些组件都可以在微软官网上下，或者百度一下都是有很多的，这里就不提供了。<br><strong>1..NET Framework 4.8</strong><br><img src="/img/Exchange2016/exchange_53.jpg"><br><img src="/img/Exchange2016/exchange_54.jpg"><br><img src="/img/Exchange2016/exchange_55.jpg"></p><p><strong>2.Visual C++ Redistributable package</strong><br><img src="/img/Exchange2016/exchange_56.jpg"><br><img src="/img/Exchange2016/exchange_57.jpg"></p><p><strong>3.UcmaRuntimeSetup</strong><br><img src="/img/Exchange2016/exchange_58.jpg"><br><img src="/img/Exchange2016/exchange_59.jpg"><br><img src="/img/Exchange2016/exchange_60.jpg"></p><p><strong>4.安装远程管理包-安装ADDS工具</strong><br><img src="/img/Exchange2016/exchange_61.jpg"></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">Install</span>-WindowsFeature RSAT-ADDS<br></code></pre></td></tr></table></figure><p>使用命令为邮箱和客户端访问服务器角色安装功能。<br><img src="/img/Exchange2016/exchange_62.jpg"></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">Install-WindowsFeature <span class="hljs-built_in">Server</span>-Media-Foundation, NET-Framework<span class="hljs-number">-45</span>-Features, RPC-over-HTTP-proxy, RSAT-Clustering, RSAT-Clustering-CmdInterface, RSAT-Clustering-Mgmt, RSAT-Clustering-PowerShell, Web-Mgmt-<span class="hljs-built_in">Console</span>, WAS-<span class="hljs-built_in">Process</span>-Model, Web-Asp-Net45, Web-Basic-Auth, Web-<span class="hljs-built_in">Client</span>-Auth, Web-Digest-Auth, Web-Dir-Browsing, Web-Dyn-Compression, Web-Http-Errors, Web-Http-Logging, Web-Http-Redirect, Web-Http-Tracing, Web-ISAPI-Ext, Web-ISAPI-Filter, Web-Lgcy-Mgmt-<span class="hljs-built_in">Console</span>, Web-Metabase, Web-Mgmt-<span class="hljs-built_in">Console</span>, Web-Mgmt-Service, Web-Net-Ext45, Web-Request-Monitor, Web-<span class="hljs-built_in">Server</span>, Web-Stat-Compression, Web-Static-Content, Web-Windows-Auth, Web-WMI, Windows-Identity-Foundation, RSAT-ADDS<br></code></pre></td></tr></table></figure><p>查询AD DS工具安装情况。<br><img src="/img/Exchange2016/exchange_63.jpg"></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">Get-WindowsFeature <span class="hljs-strong">*ADDS*</span><br></code></pre></td></tr></table></figure><p><strong>5.Exchange 2016安装部署</strong><br>右键单击下载的 Exchange ISO 图像文件，然后选择“装载”****。在显示的生成的虚拟 DVD 驱动器中，双击 Setup.exe 启动 Exchange 安装程序。</p><p><img src="/img/Exchange2016/exchange_64.jpg"><br><img src="/img/Exchange2016/exchange_65.jpg"><br>5.1 此时，Exchange Server 安装向导打开。在“检查是否有更新?”**** 页上，选择下列选项之一，再单击“下一步”**** 即可继续操作：<br>连接到 Internet 并检查是否有更新：建议选中此选项，以便搜索当前正在安装的 Exchange 版本的更新（不会检测新版累积更新）。选中此选项后会转到“正在下载更新”**** 页，以便搜索更新。单击“下一步”**** 即可继续操作。<br>暂不检查是否有更新<br><img src="/img/Exchange2016/exchange_66.jpg"><br>5.2 正在复制文件”**** 页会显示将文件复制到本地硬盘的进度。通常情况下，文件会复制到 %WinDir%\Temp\ExchangeSetup，但可以在 C:\ExchangeSetupLogs\ExchangeSetup.log 处的 Exchange 安装日志中确认位置<br><img src="/img/Exchange2016/exchange_67.jpg"><br>5.3建议在“简介”**** 页上先访问 Exchange Server 部署计划链接（如果尚未查看的话）。单击“下一步”**** 即可继续操作。<br><img src="/img/Exchange2016/exchange_68.jpg"><br>5.4在“许可协议”**** 页上，查看软件许可条款，选中“我接受许可协议中的条款”<strong><strong>，然后单击“下一步”</strong></strong> 继续操作。<br><img src="/img/Exchange2016/exchange_69.jpg"><br>5.5使用推荐设置：Exchange 会自动将错误报告和有关计算机硬件以及如何使用 Exchange 的信息发送给 Microsoft。有关发送给 Microsoft 的信息及其使用方式，请单击页面上的“?”**** 或帮助链接。<br>不使用推荐设置：将禁用推荐设置，但可以在安装程序完成后随时启用这些设置。<br>单击“下一步”**** 即可继续操作。<br><img src="/img/Exchange2016/exchange_70.jpg"><br>5.6<br>1.邮箱角色：选中此选项还会自动安装管理工具.<br>2.自动安装 Exchange 安装所需的 Windows Server 角色和功能：选中此选项可以让安装向导安装所需的 Windows 必备组件。可能需要重启计算机，才能完成一些 Windows 功能的安装。如果不选中此选项，需要手动安装 Windows 功能<br><img src="/img/Exchange2016/exchange_71.jpg"><br>5.7在“安装空间和位置”**** 页上，接受默认安装位置 (C:\Program Files\Microsoft\Exchange Server\V15)，或单击“浏览”**** 选择新位置。请确保所需的 Exchange 安装位置有足够的磁盘空间。单击“下一步”**** 继续操作。<br><img src="/img/Exchange2016/exchange_72.jpg"><br>5.8在“恶意软件防护设置”**** 页上，选择是否要禁用恶意软件扫描。恶意软件扫描默认启用（已选中值“否”<strong><strong>）。如果禁用了恶意软件扫描，稍后可以随时启用。单击“下一步”</strong></strong> 继续操作。<br><img src="/img/Exchange2016/exchange_73.jpg"><br>5.9在“准备情况检查”**** 页上，确认已成功完成组织和服务器角色先决条件检查。如果没有执行此操作，页面上只会显示“重试”**** 选项。必须先修复这些错误，然后才能继续操作,安装完成重启。<br><img src="/img/Exchange2016/exchange_74.jpg"><br><img src="/img/Exchange2016/exchange_75.jpg"><br><img src="/img/Exchange2016/exchange_76.jpg"></p><p><strong>6.0开始菜单此时已经有了Exchange，点击打开是否正常。</strong><br><img src="/img/Exchange2016/exchange_77.jpg"><br><img src="/img/Exchange2016/exchange_78.jpg"><br>至此，第一台Exchange服务器已经安装完毕，用同样的方法来安装第二台邮件服务器，安装过程与上述完全相同，这里不再做演示</p>]]></content>
    
    
    <categories>
      
      <category>Exchange2016</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Exchange2016</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Exchange Server 2016 部署系列（二）环境准备</title>
    <link href="/2021/03/02/Exchange2016/exchange2016_02/"/>
    <url>/2021/03/02/Exchange2016/exchange2016_02/</url>
    
    <content type="html"><![CDATA[<p>上一章Exchange Server 2016 部署系列（一)环境准备部署篇我们对部署AD已经有了基本的认识，接下来我们进入对Exchange Server 2016的先决条件做准备工作。</p><h2 id="先决条件准备"><a href="#先决条件准备" class="headerlink" title="先决条件准备"></a>先决条件准备</h2><p>Exchange Server 2016先决条件准备：<a href="https://docs.microsoft.com/zh-cn/Exchange/plan-and-deploy/prepare-ad-and-domains?redirectedfrom=MSDN&amp;view=exchserver-2019">https://docs.microsoft.com/zh-cn/Exchange/plan-and-deploy/prepare-ad-and-domains?redirectedfrom=MSDN&amp;view=exchserver-2019</a><br>我们接下来开始先准备:</p><p><strong>1.扩展ActiveDirectory架构</strong><br><strong>2.准备ActiveDirectory组织</strong><br><strong>3.准备ActiveDirectory域</strong></p><p><img src="/img/Exchange2016/exchange_37.jpg"><br><img src="/img/Exchange2016/exchange_38.jpg"><br><strong>1.扩展ActiveDirectory架构</strong><br>将Exchange Server 2016 安装介质解压或挂载到Exchange服务器上，并使用管理员身份打开powershell，并切换到Exchange安装目录下。<br><img src="/img/Exchange2016/exchange_39.jpg"><br><img src="/img/Exchange2016/exchange_40.jpg"><br>1.1接下来进行命令进行扩展AD架构<br><img src="/img/Exchange2016/exchange_41.jpg"><br><img src="/img/Exchange2016/exchange_42.jpg"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">.\Setup.exe <span class="hljs-regexp">/IAcceptExchangeServerLicenseTerms /</span>PrepareSchema<br></code></pre></td></tr></table></figure><p><strong>2.接下来进行命令进行准备ActiveDirectory组织</strong><br>这里以iphonefintech.com为例子<br><img src="/img/Exchange2016/exchange_43.jpg"></p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">.\Setup.exe <span class="hljs-string">/IAcceptExchangeServerLicenseTerms</span> <span class="hljs-string">/PrepareAD</span> <span class="hljs-string">/OrganizationName</span>:<span class="hljs-string">&quot;Contoso Corporation&quot;</span><br>.\Setup.exe <span class="hljs-string">/IAcceptExchangeServerLicenseTerms</span> <span class="hljs-string">/PrepareAD</span> <span class="hljs-string">/OrganizationName</span>:<span class="hljs-string">&quot;iphonefintech&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/img/Exchange2016/exchange_44.jpg"><br><strong>3.准备ActiveDirectory域</strong><br><img src="/img/Exchange2016/exchange_45.jpg"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">.\Setup.exe <span class="hljs-regexp">/IAcceptExchangeServerLicenseTerms /</span>PrepareDomain:<span class="hljs-string">&quot;Contoso Corporation&quot;</span><br>.\Setup.exe <span class="hljs-regexp">/IAcceptExchangeServerLicenseTerms /</span>PrepareDomain:<span class="hljs-string">&quot;iphonefintech.com&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/img/Exchange2016/exchange_46.jpg"><br>检查是否安装好了，打开ADSI编辑，然后单击“连接到…”,在“连接设置”中，选择“选择已知的命名上下文”，然后选择“配置”。<br><img src="/img/Exchange2016/exchange_47.jpg"><br><img src="/img/Exchange2016/exchange_48.jpg"><br>连接到“架构”命名上下文中<br>验证 ms-Exch-Schema-Verision-Pt 上的 rangeUpper 属性设置为 Exchange 2016 Active Directory 版本表中为您的 Exchange 2016 版本显示的值。<br><img src="/img/Exchange2016/exchange_49.jpg"><br>连接到“配置”命名上下文中 ，验证 CN=iphonefintech,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=iphonefintech 容器中的 objectVersion 属性是否设置为 Exchange 2016 Active Directory 版本表中为您的 Exchange 2016 版本显示的值。<br><img src="/img/Exchange2016/exchange_50.jpg"><br>连接到“配置”命名上下文中 ，验证 DC=Iphonefintech “Microsoft Exchange 系统对象”容器中的 objectVersion 属性是否设置为 Exchange 2016 Active Directory 版本表中 Exchange 2016 版本所显示的值<br><img src="/img/Exchange2016/exchange_51.jpg"><br>到这一步基本AD上的操作基本就搭建就完成了，接下来要到成员服务器的邮件服务器了。</p>]]></content>
    
    
    <categories>
      
      <category>Exchange2016</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Exchange2016</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Exchange Server 2016 部署系列（一）环境准备</title>
    <link href="/2021/03/02/Exchange2016/exchange2016_01/"/>
    <url>/2021/03/02/Exchange2016/exchange2016_01/</url>
    
    <content type="html"><![CDATA[<p><strong>近和同事一起在学习搭建Exchange server 2016，想着给自己做一下笔记，同时也方便其他想学习的小伙伴。</strong></p><h2 id="一、环境介绍"><a href="#一、环境介绍" class="headerlink" title="一、环境介绍"></a>一、环境介绍</h2><p>服务器角色情况<br><img src="/img/Exchange2016/exchange_01.jpg"><br><strong>搭建DNS和域控制器</strong><br>DNS 服务器对域来说是不可或缺的，一方面，域中的计算机使用 DNS 域名，DNS 需要为域中的计算机提供域名解析服务；另外一个重要的原因是域中的计算 机需要利用 DNS 提供的 SRV 记录来定位域控制器，因此我们在创建域之前需 要先做好 DNS 的准备工作，要么使用域控制器来做 DNS 服务器，要么使用一台单独的 DNS 服务器。这里使用一台独立的计算机来充当 DNS 服务器。<br><strong>1、添加“Active Directory 域服务”，“DNS服务器”角色，如下图所示：</strong><br><img src="/img/Exchange2016/exchange_02.jpg"><br><img src="/img/Exchange2016/exchange_03.jpg"><br><img src="/img/Exchange2016/exchange_04.jpg"><br><img src="/img/Exchange2016/exchange_05.jpg"><br><img src="/img/Exchange2016/exchange_06.jpg"><br><img src="/img/Exchange2016/exchange_07.jpg"><br><img src="/img/Exchange2016/exchange_08.jpg"><br><img src="/img/Exchange2016/exchange_09.jpg"><br><img src="/img/Exchange2016/exchange_10.jpg"><br>搭建完成以后，域控和dns角色也就添加成功，可以在开始菜单找到刚刚已经安装好的。<br><img src="/img/Exchange2016/exchange_11.jpg"><br><strong>2、创建区域并允许动态更新，如下图所示：</strong><br>首先我们要在 DNS 服务器上创建出一个区域，区域的名称和域名相同,域内计 算机的 DNS记录都创建在这个区域中。<br><img src="/img/Exchange2016/exchange_12.jpg"><br><img src="/img/Exchange2016/exchange_13.jpg"><br><img src="/img/Exchange2016/exchange_14.jpg"><br><img src="/img/Exchange2016/exchange_15.jpg"><br><img src="/img/Exchange2016/exchange_16.jpg"><br><img src="/img/Exchange2016/exchange_17.jpg"><br><img src="/img/Exchange2016/exchange_18.jpg"><br><strong>3、检查NS和SOA记录，如下图所示：</strong><br>区域创建完成后，一定要检查一下区域的 NS 记录和 SOA 记录。NS 记录描述了有多少个 DNS 服务器可以解析这个区域，SOA 记录描述了哪个 DNS 服务器是区域 的主服务器。如果 NS 记录和 SOA 记录出错，域的创建过程中就无法向 DNS 区域中写入应有的记录。<br><img src="/img/Exchange2016/exchange_19.jpg"><br><img src="/img/Exchange2016/exchange_20.jpg"><br><img src="/img/Exchange2016/exchange_21.jpg"><br><img src="/img/Exchange2016/exchange_22.jpg"><br><img src="/img/Exchange2016/exchange_23.jpg"><br><img src="/img/Exchange2016/exchange_24.jpg"><br><img src="/img/Exchange2016/exchange_25.jpg"><br><img src="/img/Exchange2016/exchange_26.jpg"><br><strong>4、添加新域（提升域控制器），如下图所示：</strong><br><img src="/img/Exchange2016/exchange_27.jpg"><br>我们选择“添加新林”，这个选项是什么意思呢？我们虽然只是简单地创建了一个域，但其实从逻辑上讲是创建了一个域林。因为域一定要隶属于域树，域树一定要隶属于域林。 L<br><img src="/img/Exchange2016/exchange_28.jpg"><br><img src="/img/Exchange2016/exchange_29.jpg"><br><img src="/img/Exchange2016/exchange_30.jpg"><br><img src="/img/Exchange2016/exchange_31.jpg"><br><img src="/img/Exchange2016/exchange_32.jpg"><br><img src="/img/Exchange2016/exchange_33.jpg"><br><img src="/img/Exchange2016/exchange_34.jpg"><br><img src="/img/Exchange2016/exchange_35.jpg"><br><img src="/img/Exchange2016/exchange_36.jpg"><br>安装完重启电脑，发现已经可以用域管理员身份登陆了，Test域控搭建成功。</p>]]></content>
    
    
    <categories>
      
      <category>Exchange2016</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Exchange2016</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
